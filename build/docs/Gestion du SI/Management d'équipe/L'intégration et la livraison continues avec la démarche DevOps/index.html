<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Test Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Test Docusaurus Atom Feed"><title data-react-helmet="true">L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps | Test Docusaurus</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/Gestion du SI/Management d&#x27;√©quipe/L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps | Test Docusaurus"><meta data-react-helmet="true" name="description" content="Qu&#x27;est-ce que l&#x27;int√©gration continue ?"><meta data-react-helmet="true" property="og:description" content="Qu&#x27;est-ce que l&#x27;int√©gration continue ?"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/Gestion du SI/Management d&#x27;√©quipe/L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/Gestion du SI/Management d&#x27;√©quipe/L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/Gestion du SI/Management d&#x27;√©quipe/L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.45508a18.css">
<link rel="preload" href="/assets/js/runtime~main.601d82d0.js" as="script">
<link rel="preload" href="/assets/js/main.c29397b4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">My Site</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Cours</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ChrisBradford2/test-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåú</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">üåû</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Base de donn√©e</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Gestion du SI</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">DevOps</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Management d&#x27;√©quipe</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Gestion du SI/Management d&#x27;√©quipe/L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps">L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Sp√©cialit√© D√©veloppement</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="quest-ce-que-lint√©gration-continue-">Qu&#x27;est-ce que l&#x27;int√©gration continue ?<a aria-hidden="true" class="hash-link" href="#quest-ce-que-lint√©gration-continue-" title="Direct link to heading">‚Äã</a></h2><blockquote><p><strong>L&#x27;int√©gration et la livraison continues</strong>, ou en anglais <em><strong>Continuous Integration and Continuous Delivery (CI/CD)</strong></em> permettent de :</p><ul><li><strong>acc√©l√©rer le <em>Time-to-Market</em></strong> (le temps de d√©veloppement et de mise en production d&#x27;une fonctionnalit√©) ;</li><li><strong>r√©duire les erreurs</strong> lors des livraisons ;</li><li>assurer une <strong>continuit√© de service</strong> des applications.</li></ul></blockquote><p><strong>L&#x27;int√©gration continue</strong> est un ensemble de pratiques utilis√©es en g√©nie logiciel, consistant √† v√©rifier, √† chaque modification de code source que le r√©sultat des modifications ne produit pas de r√©gression dans l&#x27;application d√©velopp√©e.</p><p>Le principe de l&#x27;int√©gration continue est justement de d√©tecter ces probl√®mes d&#x27;int√©gration au plus t√¥t dans le cycle de d√©veloppement.</p><blockquote><p>L&#x27;int√©gration continue va se faire en 5 √©tapes :</p><ol><li>Planifiez votre d√©veloppement.</li><li>Compilez et int√©grez votre code.</li><li>Testez votre code.</li><li>Mesurez la qualit√© de votre code.</li><li>G√©rez les livrables de votre application.</li></ol></blockquote><p>Toutes les √©tapes se feront sur GitLab. Les √©tapes 2 √† 4 seront lanc√©es automatiquement gr√¢ce √† GitLab CI :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586109893555_1c3_illus_WHITEBG%20%280-00-17-23%29_4.png" alt="√âtapes de l&#x27;int√©gration continue sur GitLab"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-1--planifiez-votre-d√©veloppement">√âtape 1 : Planifiez votre d√©veloppement<a aria-hidden="true" class="hash-link" href="#√©tape-1--planifiez-votre-d√©veloppement" title="Direct link to heading">‚Äã</a></h3><p>Afin de <strong>savoir quoi d√©velopper</strong>, il est n√©cessaire d&#x27;avoir √† disposition un outil permettant la collaboration entre les d√©veloppeurs. Cet outil permettra notamment de g√©rer les diff√©rentes releases et toutes les fonctionnalit√©s, de garantir la priorit√© du backlog, etc.</p><p>Intervenant tout au long du projet, la collaboration de toute l&#x27;√©quipe est n√©cessaire pour assurer la planification du projet. Cette planification est √©troitement li√©e √† la m√©thodologie Scrum. Elle a pour but de d√©couper le projet en petites t√¢ches √† r√©aliser par toute l&#x27;√©quipe.</p><blockquote><p>Pour collaborer avec vos √©quipes, vous pourrez utiliser <strong>Jira</strong>, <strong>GitLab</strong>, <strong>Confluence</strong>, <strong>ALM Octane</strong> ou encore <strong>Pivotal Tracker</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-2--compilez-et-int√©grez-votre-code">√âtape 2 : Compilez et int√©grez votre code<a aria-hidden="true" class="hash-link" href="#√©tape-2--compilez-et-int√©grez-votre-code" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="le-contr√¥le-de-code-source">Le contr√¥le de code source<a aria-hidden="true" class="hash-link" href="#le-contr√¥le-de-code-source" title="Direct link to heading">‚Äã</a></h4><p>Le code source se doit d&#x27;√™tre disponible √† chaque instant sur un d√©p√¥t central. Chaque d√©veloppement doit faire l&#x27;objet d&#x27;un suivi de r√©vision. Le code doit √™tre compilable √† partir d&#x27;une r√©cup√©ration fra√Æche, et ne faire l&#x27;objet d&#x27;aucune d√©pendance externe. M√™me s&#x27;il existe des notions de branche, la cr√©ation d&#x27;une branche doit √™tre √©vit√©e le plus possible, privil√©giant le d√©veloppement sur la branche principale ; cela √©vite de maintenir plusieurs versions en parall√®le. Ce genre de pratique est appel√© <em>trunk-based development</em>.</p><blockquote><p>Pour faire du contr√¥le de source, vous retrouverez les outils <strong>Git</strong>, <strong>Subversion</strong>, <strong>GitHub</strong>, <strong>GitLab</strong>, <strong>Perforce</strong> ou bien <strong>Bitbucket</strong>.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_31ik" id="lorchestrateur">L&#x27;orchestrateur<a aria-hidden="true" class="hash-link" href="#lorchestrateur" title="Direct link to heading">‚Äã</a></h4><p>Ensuite, toutes les √©tapes doivent √™tre automatis√©es par un <strong>orchestrateur</strong>, qui saura reproduire ces √©tapes et g√©rer les d√©pendances entre elles. De plus, l&#x27;utilisation d&#x27;un orchestrateur permet de donner acc√®s √† tous, et √† tout moment, √† un tableau de bord qui donnera l&#x27;√©tat de sant√© des √©tapes d&#x27;int√©gration continue. Ainsi, les d√©veloppeurs ont au plus t√¥t la boucle de feedback n√©cessaire, afin de garantir que l&#x27;application soit pr√™te √† tout moment. De plus, l&#x27;orchestrateur permettra d&#x27;aller plus loin dans la livraison continue.</p><blockquote><p>L&#x27;orchestration des √©tapes de votre int√©gration continue peut se faire gr√¢ce √† des outils comme <strong>Jenkins</strong>, <strong>TeamCity</strong>, <strong>Azure DevOps</strong>, <strong>GitLab CI</strong>, <strong>Concours CI</strong>, <strong>Travis CI</strong> ou <strong>Bamboo</strong>.</p></blockquote><p>La premi√®re √©tape, et celle qui para√Æt la plus √©vidente, est de compiler le code de mani√®re continue. En effet, sans cette √©tape, le code est compil√© manuellement sur le poste du d√©veloppeur, afin que ce dernier s&#x27;assure que son code compile.</p><p>Malheureusement, comme dit pr√©c√©demment, le d√©veloppeur ne s&#x27;assure pas que son code permet de bien compiler avec tous les autres d√©veloppements faits par l&#x27;√©quipe. √Ä la prochaine livraison, un d√©veloppeur int√®gre alors manuellement toutes les modifications, une op√©ration qui produit beaucoup de peine et de souffrance.</p><p>La mise en place d&#x27;une premi√®re √©tape de compilation dans un processus d&#x27;int√©gration continue permet justement de ne plus se soucier si des modifications de code cassent la compilation. Le d√©veloppeur doit alors s&#x27;assurer de bien envoyer son code source sur le d√©p√¥t central. En faisant cela, il d√©clenche une premi√®re √©tape de compilation, avec toutes les modifications des autres d√©veloppeurs. Si la compilation ne se fait pas, le code est alors rejet√©, et le d√©veloppeur doit corriger ses erreurs.</p><p>Apr√®s cette premi√®re √©tape, le code devient plus s√ªr, et le d√©p√¥t de code source garantit qu&#x27;√† chaque instant, un d√©veloppeur r√©cup√®re un code qui compile. Dans cette √©tape, les tests ne sont pas encore ex√©cut√©s. Le code peut donc √™tre de mauvaise qualit√©.</p><blockquote><p>Vous pourrez compiler votre code avec <strong>Maven</strong>, <strong>Ant</strong>, <strong>Gradle</strong>, <strong>MSBuild</strong>, <strong>NAnt</strong>, <strong>Gulp</strong> ou encore <strong>Grunt</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-3--testez-votre-code">√âtape 3 : Testez votre code<a aria-hidden="true" class="hash-link" href="#√©tape-3--testez-votre-code" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="les-tests-unitaires">Les tests unitaires<a aria-hidden="true" class="hash-link" href="#les-tests-unitaires" title="Direct link to heading">‚Äã</a></h4><p>Dans cette √©tape, <strong>l&#x27;orchestrateur se charge de lancer les tests unitaires √† la suite de la compilation</strong>. Ces tests unitaires, g√©n√©ralement avec un framework associ√©, garantissent que le code respecte un certain niveau de qualit√©.</p><blockquote><p>Les tests unitaires permettent de v√©rifier le bon fonctionnement d&#x27;une partie pr√©cise d&#x27;un logiciel ou d&#x27;une portion d&#x27;un programme.</p></blockquote><p>Plus il y a de tests unitaires, plus le code est garanti s√ªr. √âvidemment, l&#x27;orchestrateur ne peut lancer que les tests qui ont √©t√© cod√©s par les d√©veloppeurs, et ne peut pas inventer de nouveaux cas de tests.</p><p>Ces tests doivent s&#x27;ex√©cuter <strong>de la mani√®re la plus rapide possible</strong>, afin d&#x27;avoir un feedback le plus rapide lui aussi. Pour arriver √† ce niveau, <strong>il est n√©cessaire que les tests unitaires n&#x27;aient aucune d√©pendance</strong> vis-√†-vis de syst√®mes externes, comme par exemple une base de donn√©es, ou m√™me le syst√®me de fichiers de la machine.</p><p>Les tests unitaires apportent 3 atouts √† la production :</p><ul><li><strong>trouver les erreurs plus facilement</strong>. Les tests sont ex√©cut√©s durant tout le d√©veloppement, permettant de visualiser si le code fra√Æchement √©crit correspond au besoin ;</li><li><strong>s√©curiser la maintenance</strong>. Lors d&#x27;une modification d&#x27;un programme, les tests unitaires signalent les √©ventuelles r√©gressions. En effet, certains tests peuvent √©chouer √† la suite d&#x27;une modification, il faut donc soit r√©√©crire le test pour le faire correspondre aux nouvelles attentes, soit corriger l&#x27;erreur se situant dans le code ;</li><li><strong>documenter le code</strong>. Les tests unitaires peuvent servir de compl√©ment √† la documentation ; il est tr√®s utile de lire les tests pour comprendre comment s&#x27;utilise une m√©thode. De plus, il est possible que la documentation ne soit plus √† jour, mais les tests, eux, correspondent √† la r√©alit√© de l&#x27;application.</li></ul><p><strong>L&#x27;ensemble des tests unitaires doivent √™tre relanc√©s apr√®s une modification</strong> du code, afin de v√©rifier qu&#x27;il n&#x27;y ait pas de r√©gressions (l&#x27;apparition de nouveaux dysfonctionnements). </p><p>La multiplicit√© des test unitaires oblige √† les <strong>maintenir</strong> dans le temps, au fur et √† mesure que le d√©veloppement avance.</p><blockquote><p>Pour impl√©menter et ex√©cuter vos tests unitaires, vous retrouverez des outils comme <strong>JUnit</strong>, <strong>NUnit</strong> ou encore <strong>XUnit</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-4--mesurez-la-qualit√©-de-votre-code">√âtape 4 : Mesurez la qualit√© de votre code<a aria-hidden="true" class="hash-link" href="#√©tape-4--mesurez-la-qualit√©-de-votre-code" title="Direct link to heading">‚Äã</a></h3><p>Maintenant que les tests unitaires sont √©crits et ex√©cut√©s, nous commen√ßons √† avoir une meilleure qualit√© de code, et √† √™tre rassur√©s sur la fiabilit√© et la robustesse de l&#x27;application. Gr√¢ce √† la compilation et aux tests unitaires, nous pouvons maintenant <strong>mesurer la qualit√© du code</strong>. Tout ceci permet aux d√©veloppeurs de <strong>maintenir</strong> dans le temps un code de tr√®s bonne qualit√©, alertant l&#x27;√©quipe en cas de d√©rive des bonnes pratiques de tests.</p><blockquote><p>L&#x27;√©tape de qualit√© de code est diff√©rente de l&#x27;√©tape de test, car cette √©tape de <strong>qualit√©</strong> assure que le code sera <strong>maintenable</strong> et <strong>√©volutif</strong> au fur et √† mesure de son cycle de vie, alors que les <strong>tests</strong> servent √† garantir que le code <strong>impl√©mente bien les fonctionnalit√©s</strong> demand√©es, et ne contient pas (ou peu) de <strong>bugs</strong>.</p></blockquote><p>Lors de l&#x27;√©tape de qualit√© de code, nous cherchons √† assurer la plus petite <strong>dette technique</strong> possible de notre application. La dette technique est le temps n√©cessaire √† la correction de bugs ou √† l&#x27;ajout de nouvelles fonctionnalit√©s, lorsque nous ne respectons pas les r√®gles de coding. La dette est exprim√©e en <strong>heures de correction</strong>. Plus cette dette est √©lev√©e, plus le code sera difficile √† maintenir et √† faire √©voluer.</p><p>L&#x27;√©tape de qualit√© de code mesure aussi d&#x27;autres m√©triques, comme le nombre de vuln√©rabilit√©s au sein du code, la couverture de test, mais aussi les <a href="https://fr.wikipedia.org/wiki/Code_smell" target="_blank" rel="noopener noreferrer"><em>code smells</em></a> (qui sont des mauvaises pratiques √† ne pas impl√©menter), la <a href="https://fr.wikipedia.org/wiki/Nombre_cyclomatique" target="_blank" rel="noopener noreferrer">complexit√© cyclomatique</a> (complexit√© du code applicatif) ou la duplication de code. C&#x27;est le r√¥le du d√©veloppeur de respecter les normes d√©finies et de corriger au fur et √† mesure son code.</p><p>Afin de renforcer la qualit√© du code et de ne pas autoriser le d√©ploiement d&#x27;un code de mauvaise qualit√©, nous pouvons impl√©menter un <strong>arr√™t complet du pipeline d&#x27;int√©gration continue, si le code n&#x27;atteint pas la qualit√© requise</strong>.</p><blockquote><p><strong>Les outils</strong> : la qualit√© du code peut √™tre √©valu√©e gr√¢ce √† <strong>SonarQube</strong>, <strong>Cast</strong> ou <strong>GitLab Code Quality</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-5--g√©rez-les-livrables-de-votre-application">√âtape 5 : G√©rez les livrables de votre application<a aria-hidden="true" class="hash-link" href="#√©tape-5--g√©rez-les-livrables-de-votre-application" title="Direct link to heading">‚Äã</a></h3><p>Le code, une fois compil√©, doit √™tre d√©ploy√© dans un d√©p√¥t de livrables, et versionn√©. Les binaires produits sont appel√©s <strong><em>artefacts</em></strong>. Ces artefacts doivent √™tre accessibles √† toutes les parties prenantes de l&#x27;application, afin de pouvoir les d√©ployer et lancer les tests autres qu&#x27;unitaires (test de performance, test de bout en bout, etc.). Ces artefacts sont disponibles dans un stockage, centralis√© et organis√©, de donn√©es. Ce peut √™tre une ou plusieurs bases de donn√©es o√π les artefacts sont localis√©s en vue de leur distribution sur le r√©seau, ou bien un endroit directement accessible aux utilisateurs.</p><blockquote><p>La mise √† disposition des artefacts peut √™tre faite par <strong>Nexus</strong>, <strong>Artifactory</strong>, <strong>GitLab repository</strong>, <strong>Quay</strong>, <strong>Docker Hub</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="utilisez-gitlab-pour-mettre-en-place-un-pipeline-cicd">Utilisez GitLab pour mettre en place un pipeline CI/CD<a aria-hidden="true" class="hash-link" href="#utilisez-gitlab-pour-mettre-en-place-un-pipeline-cicd" title="Direct link to heading">‚Äã</a></h3><p>Dans la suite de ce cours, nous ferons le choix de GitLab. Cet outil a l&#x27;avantage d&#x27;avoir toutes les briques n√©cessaires √† la mise en place de l&#x27;int√©gration continue, sans rentrer dans des √©tapes complexes de mise en place des outils, ainsi que les connexions associ√©es.</p><p>Afin de pouvoir illustrer l&#x27;int√©gration continue, nous allons travailler sur un projet open source : la mise en place du site web d&#x27;une clinique v√©t√©rinaire via Spring Boot. Toutes les √©tapes de mise en place de l&#x27;int√©gration continue seront enti√®rement d√©taill√©es dans la suite de cette partie.</p><blockquote><p>Vous n&#x27;avez pas besoin de conna√Ætre Spring Boot, ni d&#x27;√™tre cal√© en d√©veloppement Java. Tout le code vous sera fourni, vous lui ferez passer toutes les √©tapes du pipeline CI/CD.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="planifiez-votre-d√©veloppement">Planifiez votre d√©veloppement<a aria-hidden="true" class="hash-link" href="#planifiez-votre-d√©veloppement" title="Direct link to heading">‚Äã</a></h2><blockquote><p>La m√©thodologie DevOps emprunte de nombreux concepts √† <strong>Scrum</strong>. Afin de bien suivre la suite de ce chapitre, il vous sera donc n√©cessaire d&#x27;avoir des connaissances du vocabulaire et de la m√©thodologie Scrum. Il vous faudra notamment conna√Ætre les termes <em>epic</em>, <em>user story</em>, <em>task</em>, <em>bug</em>, <em>sprint</em>, <em>Product Backlog</em>, <em>board</em>,<em>burndown chart</em>, <em>Definition of Done</em>, <em>Definition of Ready</em>, tels que d√©finis par la m√©thodologie Scrum.</p></blockquote><p>Dans GitLab, l&#x27;<strong>issue</strong> est la notion centrale pour d√©finir n&#x27;importe quoi : que ce soit une epic, une feature ou m√™me un bug. La distinction se fait via des labels, que l&#x27;on positionne sur l&#x27;issue.</p><p>Il est temps de d√©finir notre premier <strong>backlog</strong>, c&#x27;est-√†-dire l&#x27;ensemble des t√¢ches √† r√©aliser sur notre projet.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="cr√©ez-votre-projet-gitlab">Cr√©ez votre projet GitLab<a aria-hidden="true" class="hash-link" href="#cr√©ez-votre-projet-gitlab" title="Direct link to heading">‚Äã</a></h3><p>Dans un premier temps, nous allons <strong>cr√©er un projet dans GitLab</strong>. Pour cela, nous allons utiliser la plateforme <a href="https://gitlab.com/" target="_blank" rel="noopener noreferrer">https://gitlab.com/</a>, afin d&#x27;√©viter d&#x27;installer notre propre plateforme GitLab en local.</p><p>Si vous n&#x27;avez pas encore de compte sur GitLab, je vous invite √† vous en cr√©er un, puis √† vous connecter.</p><p>Une fois connect√©, vous arrivez sur une page listant tous vos projets. Si vous venez de cr√©er le compte, normalement cette page sera vide.</p><blockquote><p>Comme expliqu√© dans le premier chapitre, nous allons nous baser sur le projet <strong>PetClinic</strong> tout au long du cours. Dans ce chapitre, nous allons commencer √† planifier le d√©veloppement de fonctionnalit√©s pour ce projet.</p></blockquote><p>Pour <strong>cr√©er un nouveau projet dans GitLab</strong>, une fois connect√©, cliquez sur le bouton <code>New Project</code>. Sur la nouvelle page, il faut entrer un nouveau nom de projet. Dans le champ Project Name, nous allons entrer le nom <strong>spring-petclinic-microservices</strong>. Notez au passage que GitLab remplit automatiquement le champ Project Slug. Il est imp√©ratif de passer le projet en <strong>Public</strong> afin de b√©n√©ficier de toutes les fonctionnalit√©s abord√©es dans ce cours. Une fois tous les champs remplis, l&#x27;√©cran devrait ressembler √† cela :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586242595092_new-project-detail.png" alt="Cr√©ation d&#x27;un projet sur Gitlab"></p><p>Appuyez maintenant sur le bouton <em>Create Project</em>. Vous arrivez alors sur la page du projet fra√Æchement cr√©√©. Avant de r√©cup√©rer le code source de l&#x27;application, et de l&#x27;int√©grer dans GitLab, nous allons mettre en place les diff√©rentes briques n√©cessaires au bon d√©roulement du projet. Tout d&#x27;abord, nous allons naviguer dans la partie Issues, afin d&#x27;ajouter les colonnes n√©cessaires √† notre projet. Pour ce faire, il suffit d&#x27;aller sur le menu √† gauche, survoler le menu Issues, et cliquer sur le lien Boards. Sur cette page, GitLab nous propose d&#x27;ajouter les listes par d√©faut via le bouton Add default lists. GitLab cr√©e alors deux nouvelles colonnes, To Do et Doing :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586243172078_boards-new.png" alt="Votre board sur GitLab"></p><p>Ce <strong>board</strong> sera notre board par d√©faut durant tout notre projet, afin de voir son avancement. Nous allons ensuite <strong>cr√©er les diff√©rents labels</strong> que nous avons vus pr√©c√©demment, afin de pouvoir cr√©er et cat√©goriser les issues que nous allons ouvrir. Pour ce faire, nous allons aller dans le sous-menu Labels du menu Issues. Sur la nouvelle page, il faut alors cliquer sur le bouton <strong>New Label</strong> pour cr√©er une nouvelle cat√©gorie d&#x27;issue. Notez que GitLab a d√©j√† cr√©√© les deux labels To Do et Doing pour nous.</p><p>Sur la page de cr√©ation de nouveaux labels, nous allons ajouter tous les labels n√©cessaires √† la cat√©gorisation des issues :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586244055298_label-new.png" alt="Cr√©ation d&#x27;un nouveau label"></p><blockquote><p><strong>Les cat√©gories √† cr√©er sont</strong> : Epic, User Story, Bug, Ready, Rejected, High, Medium, Low, In Review. Une fois les labels cr√©√©s, la liste devrait ressembler √† ceci :</p></blockquote><p><img src="https://user.oc-static.com/upload/2019/05/23/15586244563257_labels-list.png" alt="Tous vos labels sont pr√™ts !"></p><p>Vous noterez la cr√©ation de plusieurs labels que je n&#x27;ai pas d√©taill√©s : High, Medium, Low, Ready, Rejected et In Review. Ces labels sont utilis√©s pour cat√©goriser plusieurs issues et pour cr√©er un nouveau board, que nous allons appeler <strong>Product Backlog</strong>. Pour ce faire, il faut retourner dans le menu Board. Tout d&#x27;abord, dans la page courante, cliquez sur Add List et s√©lectionnez le label In Review pour ajouter une nouvelle colonne dans le board courant. Le nouveau board doit ressembler √† cela (pour des questions de lisibilit√©, j&#x27;ai repli√© les colonnes Open et Closed dans la capture d&#x27;√©cran suivante) :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586245146433_development-board.png" alt="Nouvelle colonne sur votre board de d√©veloppement"></p><p>Ensuite, sur la page, en haut √† gauche, il y a une liste d√©roulante contenant tous les boards cr√©√©s. Pour l&#x27;instant, il n&#x27;y en a qu&#x27;un seul, celui de d√©veloppement qui est actuellement affich√©.</p><p>Dans cette liste d√©roulante, s√©lectionnez <strong>Create New Board</strong>, puis donnez-lui le nom de <strong>Product</strong>. Ce board sera notre <strong>Product Backlog</strong> qui listera toutes les epics, ainsi que les user stories associ√©es et leurs √©tats respectifs :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/1558624642716_new-board.png" alt="Cr√©ez votre Product Backlog"></p><p>Sur la nouvelle page, apr√®s avoir cliqu√© sur le bouton Create Board, il faut maintenant ajouter les colonnes Low, Medium, High et Rejected afin de pouvoir classifier les epics sur ce board. Pour ce faire, il faut cliquer sur la liste d√©roulante Add List, et ajouter les labels correspondants.</p><p>Votre board devrait ressembler maintenant √† cela :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586246843437_product-board-detail.png" alt="Votre Product Backlog"></p><p>Nous avons maintenant tous les outils n√©cessaires afin de commencer notre travail sur le projet. Le workflow de d√©veloppement se d√©roule comme suit :</p><ol><li>Le product owner travaille avec les utilisateurs finaux afin de d√©finir un <strong>Product Backlog</strong>. Ce Product Backlog est constitu√© de diff√©rentes <strong>epics</strong>.</li><li>Ces <strong>epics</strong> doivent faire appara√Ætre plusieurs crit√®res, comme par exemple des wireframes ou autres √©crans d√©finissant l&#x27;application. Une epic en high passe en sprint backlog lorsque son p√©rim√®tre est d√©limit√© avec un label <strong>Ready</strong>, et le d√©veloppement est confirm√© avec le client. Ce n‚Äôest qu‚Äô√† ce moment que l‚Äôepic est discut√©e avec l‚Äô√©quipe et d√©compos√©e en user stories, d√©crivant la feature √† d√©velopper.</li><li>Les <strong>user stories</strong> doivent respecter la Definition of Ready d√©finie plus t√¥t, lors du cycle de d√©veloppement. Une user story n&#x27;est ready que si elle a bien √©t√© √©crite, et contient tous les √©l√©ments n√©cessaires √† son d√©veloppement durant le sprint.</li><li>Une fois que le sprint backlog a √©t√© d√©compos√© en user stories, nous pouvons alors commencer la planification du sprint backlog.</li></ol><p>Pour ce cours, nous allons cr√©er <strong>deux issues</strong> :</p><ul><li><strong>une epic</strong> ;</li><li><strong>une user story</strong>.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="cr√©ez-votre-premi√®re-epic">Cr√©ez votre premi√®re epic<a aria-hidden="true" class="hash-link" href="#cr√©ez-votre-premi√®re-epic" title="Direct link to heading">‚Äã</a></h3><p>Pour cr√©er une <strong>epic</strong>, le plus simple est d&#x27;aller dans le sous-menu List du menu Issues, et de cliquer sur le bouton <strong>New Issue</strong>.</p><p>Sur la nouvelle page, il faut alors renseigner les champs n√©cessaires. Commen√ßons par renseigner le titre, ainsi que la description de l&#x27;issue :</p><p><strong>Titre de l&#x27;issue :</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">[EPIC] Gestion des v√©t√©rinaires</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Description de l&#x27;issue :</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Dans le projet *PetClinic*, il faut ajouter la gestion des v√©t√©rinaires.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impl√©mentation de :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Cr√©ation des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Recherche des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Mise √† jour des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Suppression des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T√¢ches √† faire :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [x] Cr√©ation des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [x] Recherche des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [x] Mise √† jour des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [ ] Suppression des v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [ ] Supprimer les v√©t√©rinaires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [x] Suppression de la base de donn√©es</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Ajoutez-lui le label Epic :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586247348176_new-epic.png" alt="Cr√©ez votre premi√®re epic"></p><p>Et enregistrez en cliquant sur le bouton Submit Issue.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="cr√©ez-votre-premi√®re-user-story">Cr√©ez votre premi√®re user story<a aria-hidden="true" class="hash-link" href="#cr√©ez-votre-premi√®re-user-story" title="Direct link to heading">‚Äã</a></h3><p>La deuxi√®me issue sera de type user story. Ajoutez une nouvelle issue en cliquant sur le bouton New Issue :</p><p><strong>Titre de l&#x27;issue :</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">[User story] Suppression du v√©t√©rinaire</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Description de l&#x27;issue :</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">En tant qu&#x27;administrateur, je dois pouvoir supprimer un v√©t√©rinaire afin que celui-ci ne s&#x27;affiche plus dans l&#x27;application</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Et enregistrez-la.</p><p>Si vous revenez sur la liste des issues, vous avez maintenant deux issues cr√©√©es :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586248070332_list-issues.png" alt="Vos 2 issues cr√©√©es"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="organisez-votre-backlog">Organisez votre backlog<a aria-hidden="true" class="hash-link" href="#organisez-votre-backlog" title="Direct link to heading">‚Äã</a></h3><p>Nous allons maintenant <strong>associer la user story</strong> fra√Æchement cr√©√©e √† l&#x27;epic que l&#x27;on a cr√©√©e auparavant. Pour ce faire, il suffit d&#x27;aller sur la description de l&#x27;epic, de cliquer sur le bouton +, au niveau du menu Related Issues, d&#x27;ajouter le num√©ro de la user story (dans mon cas, #5), et de cliquer sur Add.</p><p>Si nous retournons maintenant sur le menu Boards, nous allons voir que sur les deux boards cr√©√©s (Development et Product), dans la partie Open, nous avons nos deux issues cr√©√©es pr√©c√©demment :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586248607207_board-not-filtered.png" alt="Votre user story associ√©e √† votre epic"></p><p>Cependant, nous ne voulons voir ici que les issues associ√©es √† chacun des boards (user stories pour le board Development, et epic pour le board Product). Pour ce faire, il suffit de cliquer sur le bouton Edit Board, et d&#x27;ajouter uniquement les labels qui nous int√©ressent :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586249458233_edit-board-development.png" alt="Configurez vos boards"></p><p>En modifiant les boards, nous nous retrouvons bien avec les issues qui nous int√©ressent sur chacun des boards.</p><p>En d√©pla√ßant nos issues sur chacun des boards, nous pouvons jouer sur la priorisation des epics, ou l&#x27;avancement des user stories.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586250482371_priorizing-product.png" alt="Priorisez vos epics"></p><p>La derni√®re chose √† faire est de cr√©er un sprint, et de voir le burndown chart associ√©. Pour ce faire, il faut aller dans le menu Milestones, et cliquer sur le bouton New Milestone.</p><p>Ensuite, il suffit de remplir les informations du sprint, et de cliquer sur le bouton Create Milestone :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586251686628_new-milestone-detail.png" alt="Cr√©ez une milestone"></p><p>Nous avons maintenant acc√®s au burndown chart du sprint en cours :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586252007218_burndown-chart.png" alt="Votre burndown chart"></p><p>Afin <strong>d&#x27;associer des issues au sprint en cours</strong>, il suffit d&#x27;aller sur chacune des issues que l&#x27;on souhaite associer au sprint, et de modifier leur propri√©t√© sur le menu √† droite. Dans cet exemple, j&#x27;ai modifi√© le milestone, le time tracking (en commentant l&#x27;issue avec les commandes /estimate et /spend), la due date, le weight, et je me suis assign√© l&#x27;issue :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586252464075_edit-issue.png" alt="Timeline d&#x27;√©volution des boards"></p><p>Dor√©navant, toute l&#x27;√©quipe pourra suivre l&#x27;avancement du burndown chart facilement :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586252982251_burndown-chart-complete.png" alt="Burndown chart accessible √† toute l&#x27;√©quipe !"></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="int√©grez-votre-code-en-continu">Int√©grez votre code en continu<a aria-hidden="true" class="hash-link" href="#int√©grez-votre-code-en-continu" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="clonez-le-projet-sur-votre-poste">Clonez le projet sur votre poste<a aria-hidden="true" class="hash-link" href="#clonez-le-projet-sur-votre-poste" title="Direct link to heading">‚Äã</a></h3><p>Pour pouvoir commencer √† travailler sur le projet, afin de r√©cup√©rer le code source, nous allons dans un premier temps <strong>cloner le repository Git</strong>. Pour ce faire, retournez sur la <strong>page d&#x27;accueil du projet</strong> o√π se trouvent toutes les instructions n√©cessaires au clonage du projet.</p><p>Cliquez en haut √† droite sur le bouton bleu <strong>Clone</strong>, et copiez la deuxi√®me ligne de la pop-up <strong>Clone with HTTPS</strong>.</p><p>Prenez ensuite une console d&#x27;ordinateur, repr√©sentant votre poste de d√©veloppeur, et clonez le repository en tapant la commande suivante :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://gitlab.com/[votre-nom-d-utilisateur]/spring-petclinic-microservices.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd spring-petclinic-microservices</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Une fois le clone fait, nous nous retrouvons avec un dossier vide o√π la branche <code>master</code> est associ√©e √† notre repository GitLab. Nous allons <strong>ajouter une branche</strong> <code>upstream</code> sur GitHub et puller les derni√®res modifications GitHub. Les commandes √† taper sont les suivantes :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">git remote add upstream https://github.com/spring-petclinic/spring-petclinic-microservices.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git pull upstream master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push origin master</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Normalement, si les commandes pr√©c√©dentes ont √©t√© ex√©cut√©es, le dossier Git devrait contenir le code source du projet PetClinic, ainsi que toutes les modifications associ√©es.</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589768409364_gitlab.png" alt="Votre projet GitLab une fois le code clon√©"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="activez-lint√©gration-continue-sur-votre-projet-avec-gitlab">Activez l&#x27;int√©gration continue sur votre projet avec GitLab<a aria-hidden="true" class="hash-link" href="#activez-lint√©gration-continue-sur-votre-projet-avec-gitlab" title="Direct link to heading">‚Äã</a></h3><p>Nous allons maintenant ajouter un <strong>pipeline d&#x27;int√©gration continue</strong>, afin d&#x27;impl√©menter les diff√©rentes √©tapes que nous avons vues pr√©c√©demment. Les √©tapes de ce pipeline seront lanc√©es successivement, lors de chaque nouveau push du code sur le repo. Voici √† quoi ressemblera le pipeline :</p><p><img src="https://user.oc-static.com/upload/2019/05/29/15591251962731_1c3_illus_WHITEBG%20%280-00-17-23%29_0.png" alt="Les √©tapes que nous allons mettre en place"></p><p>Pour <strong>activer l&#x27;int√©gration continue sur GitLab</strong>, le plus simple est de cliquer sur le bouton Set up CI/CD sur la page d&#x27;accueil du projet. Cette commande va cr√©er le fichier <code>gitlab-ci.yml</code> dans votre projet. C&#x27;est sur ce fichier que vous d√©crirez tout votre pipeline CI/CD avec la syntaxe YAML.</p><p>Et d&#x27;ajouter les lignes suivantes dans le fichier :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;$CI_JOB_NAME&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mvnw compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dhttps.protocols=TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.showDateTime=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Djava.awt.headless=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fail</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">at</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">end </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">version </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DinstallAtEnd=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DdeployAtEnd=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openjdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mvnw test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dhttps.protocols=TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.showDateTime=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Djava.awt.headless=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fail</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">at</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">end </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">version </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DinstallAtEnd=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DdeployAtEnd=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openjdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Ce fichier est la pierre angulaire de l&#x27;impl√©mentation d&#x27;un pipeline dans GitLab. Ce fichier s&#x27;appelle <code>.gitlab-ci.yml</code>, et c&#x27;est ici que nous allons d√©finir notre pipeline. Dans cet exemple, nous avons impl√©ment√© <strong>deux √©tapes</strong> :</p><ul><li>l&#x27;√©tape de compilation avec la t√¢che <code>build_job</code> ;</li><li>l&#x27;√©tape des tests avec la t√¢che <code>test_job</code>.</li></ul><p><strong>D√©couvrons le fichier bloc par bloc !</strong></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="d√©finissez-les-√©tapes-du-pipeline">D√©finissez les √©tapes du pipeline<a aria-hidden="true" class="hash-link" href="#d√©finissez-les-√©tapes-du-pipeline" title="Direct link to heading">‚Äã</a></h4><p>Dans un premier temps, je d√©finis les <strong>√©tapes</strong> de mon pipeline avec le mot cl√© <code>stages</code>. Ce mot cl√© permet de d√©finir l&#x27;ordre des √©tapes. Ici, la premi√®re √©tape va √™tre le <code>build</code>, et ensuite les <code>tests</code>. </p><p>√áa veut dire que les <strong>t√¢ches</strong> (ou <em>jobs</em> en anglais) associ√©es √† <strong>l&#x27;√©tape</strong> <code>build</code> (ici <code>build_job</code>) vont s&#x27;ex√©cuter en premier, puis les t√¢ches de l&#x27;√©tape <code>test</code> (ici <code>test_job</code>).</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="acc√©l√©rez-les-√©tapes-avec-le-cache">Acc√©l√©rez les √©tapes avec le cache<a aria-hidden="true" class="hash-link" href="#acc√©l√©rez-les-√©tapes-avec-le-cache" title="Direct link to heading">‚Äã</a></h4><p>Le deuxi√®me bloc, avec le mot cl√© <code>cache</code>, est ici utilis√© pour acc√©l√©rer toutes nos √©tapes. Effectivement, dans le cas d&#x27;une compilation Java avec Maven (notre cas), cette compilation r√©cup√®re beaucoup de d√©pendances et de librairies externes. Ces librairies sont stock√©es dans le r√©pertoire <code>.m2</code>.</p><p>Gr√¢ce √† l&#x27;utilisation du mot cl√© <code>cache</code> et de la variable pr√©d√©finie de GitLab <code>$CI_JOB_NAME</code>, ce r√©pertoire est commun √† tous les jobs du pipeline.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="d√©finissez-les-jobs-√†-effectuer">D√©finissez les jobs √† effectuer<a aria-hidden="true" class="hash-link" href="#d√©finissez-les-jobs-√†-effectuer" title="Direct link to heading">‚Äã</a></h4><p>Ensuite, je d√©clare deux jobs, correspondant chacun √† une des √©tapes de notre pipeline d&#x27;int√©gration continue. Dans ces deux jobs, nous voyons que nous avons trois diff√©rentes lignes. D√©couvrons √† quoi ces lignes correspondent :</p><ul><li><code>stage</code> : c&#x27;est le nom de l&#x27;√©tape qui va appara√Ætre dans notre pipeline d&#x27;int√©gration continue. Cela correspond aussi au <code>stage</code> auquel sera ex√©cut√© le job ;</li><li><code>script</code> : ce sont les lignes de script √† lancer afin d&#x27;ex√©cuter l&#x27;√©tape. Ici, nous lan√ßons le script Maven suivant son lifecycle. Dans la partie - <code>build</code>, nous lan√ßons la compilation ; et dans la partie <code>test</code>, nous lan√ßons les tests de l&#x27;application. D&#x27;autres options sont d√©finies afin d&#x27;acc√©l√©rer le temps de traitement de ces lignes. Le <code>script</code> va alors t√©l√©charger Maven, l‚Äôoutil de compilation, toutes les d√©pendances de l‚Äôapplication, et lancer la compilation du projet ;</li><li><code>image</code> : c&#x27;est l&#x27;image Docker qui va √™tre lanc√©e par GitLab afin d&#x27;ex√©cuter les lignes de script que nous avons d√©finies. Ici, l&#x27;image <code>openjdk:8-alpine</code>, qui contient d√©j√† Java 8, va √™tre lanc√©e afin de pouvoir compiler le projet. Une fois le fichier sauvegard√©, le pipeline de build se lance, et vous devriez voir les diff√©rentes √©tapes se lancer (ici, l&#x27;√©tape de build et l&#x27;√©tape de test).</li></ul><p>Lors de l&#x27;√©tape de <code>test</code>, le pipeline va ex√©cuter les tests unitaires d√©j√† pr√©sents au sein du projet. L&#x27;objectif de cette √©tape est de s&#x27;assurer de lancer les tests √©crits par les d√©veloppeurs. <strong>Si un seul de ces tests √©choue, le pipeline s&#x27;arr√™te</strong>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="lancez-votre-pipeline-cicd">Lancez votre pipeline CI/CD<a aria-hidden="true" class="hash-link" href="#lancez-votre-pipeline-cicd" title="Direct link to heading">‚Äã</a></h3><p>Pour voir le pipeline complet, il suffit de cliquer sur le sous-menu Pipelines dans le menu CI/CD.</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589772375269_pipeline.png" alt="La page Pipeline avec toutes les ex√©cutions du pipeline"></p><p>En cliquant sur le statut <em>running</em> du pipeline, nous avons plus de d√©tails sur ce pipeline, les jobs associ√©s ainsi que leurs statuts.</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589773076171_pipeline-detail.png" alt="D√©tail d&#x27;ex√©cution du pipeline"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="et-si-lapplication-contient-un-bug-">Et si l&#x27;application contient un bug ?<a aria-hidden="true" class="hash-link" href="#et-si-lapplication-contient-un-bug-" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="lancez-votre-pipeline-avec-un-bug">Lancez votre pipeline avec un bug<a aria-hidden="true" class="hash-link" href="#lancez-votre-pipeline-avec-un-bug" title="Direct link to heading">‚Äã</a></h4><blockquote><p>Afin de d√©montrer un workflow typique de CI/CD, nous allons <strong>introduire un bug dans l&#x27;application</strong>. üêõ Ainsi, nous verrons comment le pipeline de CI/CD le d√©tecte, et le corrige. Dans un premier temps, nous allons r√©cup√©rer le fichier que nous venons de cr√©er :</p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">git pull</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Le dossier courant devrait avoir le nouveau fichier <code>.gitlab-ci.yml</code>. Nous allons √©diter un fichier afin d&#x27;introduire un bug. Dans un premier temps, cr√©ez une nouvelle branche qui va accueillir nos modifications :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">git checkout -b refactor-customers</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Ensuite, <strong>√©ditez le fichier</strong> Java &quot;<em>spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/CustomersServiceApplication.java</em>&quot; Supprimez par exemple le &quot; <strong>;</strong> &quot; situ√© √† la fin de la ligne <code>package org.springframework.samples.petclinic.customers</code> et commitez les changements dans Git :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">git add spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/CustomersServiceApplication.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m &quot;Refactorisation du code des clients&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push origin refactor-customers</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Vous devriez maintenant avoir deux branches visibles sur la page d&#x27;accueil du projet.</p><p><strong>Puisque vous avez introduit un bug, le pipeline de build est maintenant en √©chec :</strong></p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589774662327_build-failed.png" alt="Pipeline en √©chec"></p><p>En cliquant sur la croix rouge dans la colonne Stage, nous avons le d√©tail de l&#x27;erreur (ici, le bug que nous avons introduit) :</p><p><img src="https://user.oc-static.com/upload/2019/05/27/155897750423_build-failed-detail.png" alt="D√©tail de l&#x27;erreur d&#x27;ex√©cution du pipeline"></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="g√©rez-le-fix-du-bug-sur-gitlab">G√©rez le fix du bug sur GitLab<a aria-hidden="true" class="hash-link" href="#g√©rez-le-fix-du-bug-sur-gitlab" title="Direct link to heading">‚Äã</a></h4><p>Pour enregistrer le bug, nous pouvons cr√©er un nouveau Bug directement en cliquant sur le bouton New Issue. Il faut alors remplir les champs ad√©quats comme l&#x27;assignee, le milestone, les labels (Bug et User Story) ou la due date :</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589775778674_new-bug.png" alt="Cr√©ation d&#x27;une nouvelle issue Bug dans GitLab"></p><p>Une fois l&#x27;issue compl√©t√©e, nous avons tous les d√©tails du bug √† corriger et le job en √©chec est automatiquement r√©cup√©r√© :</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589777460194_new-bug-created.png" alt="Nouveau bug cr√©√©"></p><p>Si nous revenons sur le board Development, nous nous apercevons que l&#x27;issue cr√©√©e appara√Æt dans la colonne Open. Nous pouvons alors la d√©placer dans la colonne Doing, car nous allons la corriger.</p><p>Pour corriger ce bug automatiquement, nous allons cr√©er une merge request, c&#x27;est-√†-dire demander √† commiter les changements sur notre branche dans la branche principale <code>master</code>. Pour ce faire, il faut aller dans le menu Merge Requests et cliquer sur New Merge Request.</p><p>Dans la nouvelle page, il faut choisir la branche que nous voulons merger dans la branche principale (ici, la branche <code>monbug</code>) et cliquer sur &quot;Compare branches and continue&quot; :</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589789051477_compare-branches.png" alt="Comparaison des branches Master et Monbug"></p><p>Au prochain √©cran, il faut remplir les champs de fa√ßon ad√©quate, et cliquer sur Submit Merge Request. Pour le champ Description, la syntaxe est &quot;Closes&quot; et le num√©ro du bug, ici, le 6 :</p><ul><li>Title : <em>WIP: Mon premier bug</em> ;</li><li>Description : <em>Closes #6</em> ;</li><li>Assignee : <em>Assign to me</em> ;</li><li>Milestone : <em>Sprint 1</em>.</li></ul><p><img src="https://user.oc-static.com/upload/2019/05/27/15589790588121_submit-merge-request.png" alt="Description de mon bug"></p><p>Une fois la merge request cr√©√©e, nous avons tous les d√©tails de celle-ci :</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589790991082_merge-request-detail.png" alt="Description de mon bug"></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="corrigez-votre-bug">Corrigez votre bug<a aria-hidden="true" class="hash-link" href="#corrigez-votre-bug" title="Direct link to heading">‚Äã</a></h4><p>l est temps de corriger notre bug. Nous allons √©diter le fichier que nous avons modifi√©. Pour cela, nous allons r√©introduire le &quot; <strong>;</strong> &quot; manquant, puis commiter le code corrig√© sur la branche <code>monbug</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">git add spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/CustomersServiceApplication.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m &quot;Correction du bug clients&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push origin monbug</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Vous allez constater qu&#x27;une fois le code push√© sur la branche <code>monbug</code>, le pipeline de build se lance afin de v√©rifier que le code que nous avons envoy√© fonctionne.</p><p>Une fois que le pipeline s&#x27;est termin√© en succ√®s, nous pouvons alors enlever le statut Work in progress en cliquant sur le bouton Resolve WIP status, pour ensuite cliquer sur le bouton Merge :</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589794618626_merge-branches.png" alt="Bug r√©solu, mergez les branches !"></p><p>Le pipeline se lance alors une derni√®re fois pour v√©rifier que le code merg√© ne casse pas la compilation.</p><p>Enfin, si nous revenons sur le board Development, nous voyons que le bug est automatiquement ferm√©, suite √† notre merge request.</p><p><img src="https://user.oc-static.com/upload/2019/05/29/15591253758662_1c3_illus_WHITEBG%20%280-00-17-23%29_2.png" alt="Les 2 premi√®res √©tapes du pipeline sont fonctionnelles ‚úÖ"></p><blockquote><p>Nous avons donc rempli les 3 premi√®res √©tapes de l&#x27;int√©gration continue :</p><ol><li>‚úÖPlanifiez votre d√©veloppement.</li><li>‚úÖCompilez et int√©grez votre code.</li><li>‚úÖTestez votre code.</li><li>Mesurez la qualit√© de votre code.</li><li>G√©rez les livrables de votre application.</li></ol></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="garantissez-la-qualit√©-de-votre-code">Garantissez la qualit√© de votre code<a aria-hidden="true" class="hash-link" href="#garantissez-la-qualit√©-de-votre-code" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="mesurez-la-qualit√©-de-votre-code">Mesurez la qualit√© de votre code<a aria-hidden="true" class="hash-link" href="#mesurez-la-qualit√©-de-votre-code" title="Direct link to heading">‚Äã</a></h3><p>Commen√ßons par <strong>l&#x27;analyse de code statique</strong>, afin de contr√¥ler la <strong>qualit√© du code</strong>.</p><p>Nous allons donc modifier le pipeline de code, afin d&#x27;ajouter cette analyse de code. Il faut alors modifier le fichier <code>.gitlab-ci.yml</code> afin qu&#x27;il ressemble √† ceci :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> quality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;$CI_JOB_NAME&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mvnw compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dhttps.protocols=TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.showDateTime=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Djava.awt.headless=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fail</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">at</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">end </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">version </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DinstallAtEnd=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DdeployAtEnd=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openjdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mvnw test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dhttps.protocols=TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.showDateTime=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Djava.awt.headless=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fail</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">at</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">end </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">version </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DinstallAtEnd=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DdeployAtEnd=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openjdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">code_quality_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> quality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allow_failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkdir codequality</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">env CODECLIMATE_CODE=&quot;$PWD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume &quot;$PWD&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume /var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume /tmp/cc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        codeclimate/codeclimate analyze </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f html </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> ./codequality</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> codequality</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>Ici, j&#x27;ai ajout√© une √©tape suppl√©mentaire de qualit√© de code. L&#x27;√©tape (<em>le stage</em>) <code>quality</code> est d√©fini dans le bloc <code>stages</code>. Cela veut dire que le pipeline va ajouter un job de qualit√© √† la suite de la compilation et des tests. Ce job, je l&#x27;ajoute √† la fin du fichier et il est appel√© <code>code_quality_job</code>.</p></blockquote><p>Dans ce job, nous retrouvons les 3 lignes des √©tapes pr√©c√©dentes, plus d&#x27;autres lignes :</p><ul><li><code>allow_failure</code> : cette ligne <strong>autorise l&#x27;√©chec de l&#x27;√©tape de qualit√©</strong>. Comme ce n&#x27;est pas une √©tape critique, nous nous permettons d&#x27;autoriser l&#x27;√©chec et de laisser le pipeline continuer ;</li><li><code>services</code> : ce nouveau mot cl√© de GitLab permet de <strong>d√©marrer un d√©mon Docker</strong>, pour que l‚Äôex√©cution de notre programme d‚Äôanalyse de code puisse se faire. Cette ligne nous permet d&#x27;ex√©cuter Docker au sein de l&#x27;image, afin d&#x27;ex√©cuter l&#x27;analyse de code ;</li><li><code>script</code> : cette ligne est un peu plus compliqu√©e que les lignes de script pr√©c√©dentes. La premi√®re ligne va cr√©er un dossier  <code>codequality-results/</code> qui contiendra le r√©sultat de l&#x27;analyse de code. La deuxi√®me ligne monte le code √† l&#x27;int√©rieur d&#x27;une image Docker via le dossier <code>/code</code>, et lance l&#x27;analyse via le programme <code>codequality</code>. Le r√©sultat sera export√© dans le dossier <code>codequality-results</code> ;</li><li><code>artifact</code> : cette ligne est un pr√©requis de GitLab si nous voulons voir notre √©volution de qualit√©. Le dossier <code>codequality-results/</code> sera stock√© <strong>au sein de GitLab</strong> afin de pouvoir voir le r√©sultat de l&#x27;analyse du scan. Ce r√©sultat sera disponible et visible au sein du job <code>code_quality_job</code>.</li></ul><p>Tout le script est ex√©cut√© au sein de l&#x27;image <code>docker:stable</code>. Cette image permet de d√©marrer le programme d‚Äôanalyse de code.</p><p>Une fois le fichier commit√© sous Git et envoy√© sur GitLab via les commandes suivantes, le pipeline d&#x27;int√©gration continue va alors se mettre √† jour et lancer une compilation, suivie d&#x27;une analyse statique du code.</p><p>Le code est alors <strong>analys√© par GitLab</strong>, et le rapport g√©n√©r√© stock√© au niveau des artefacts. Pour voir le r√©sultat de l&#x27;analyse de code, il suffit de naviguer dans le job <code>code_quality_job</code>, puis de cliquer sur Browse. Vous aurez alors acc√®s au dossier contenant le r√©sultat de l&#x27;analyse de code, et pourrez naviguer au sein de ce fichier, afin de voir les am√©liorations √† apporter au code.</p><p>√áa y est, l&#x27;√©tape de qualit√© est impl√©ment√©e !</p><p><img src="https://user.oc-static.com/upload/2019/05/29/15591255853183_1c3_illus_WHITEBG%20%280-00-17-23%29_3.png" alt="L&#x27;√©tape de qualit√© est impl√©ment√©e ‚úÖ"></p><blockquote><p>D&#x27;autres outils existent pour voir la qualit√© d&#x27;un code de d√©veloppement. Le plus connu est <strong>SonarQube</strong>, qui permet d&#x27;afficher des rapports de qualit√©, l&#x27;√©volution de ceux-ci, ainsi qu&#x27;une d√©tection partielle des erreurs. </p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="packagez-votre-application-pour-la-d√©ployer">Packagez votre application pour la d√©ployer<a aria-hidden="true" class="hash-link" href="#packagez-votre-application-pour-la-d√©ployer" title="Direct link to heading">‚Äã</a></h3><p>La prochaine √©tape apr√®s la qualit√© du code est le <strong>packaging</strong> de l&#x27;application, afin de pouvoir la d√©ployer plus facilement. Pour ce projet, nous allons choisir <strong>Docker</strong> comme programme de packaging.</p><blockquote><p>Si vous n&#x27;√™tes pas √† l&#x27;aise avec les conteneurs Docker, ils seront expliqu√©s plus en d√©tail <strong>dans la seconde partie de ce cours</strong>, quand nous verrons la livraison continue.</p></blockquote><p>GitLab vient avec une registry Docker incluse, ce qui nous permet de stocker ces images au sein de GitLab. Pour pouvoir packager nos images Docker, il est n√©cessaire d&#x27;ajouter une nouvelle √©tape √† notre pipeline d&#x27;int√©gration continue. Nous allons une nouvelle fois modifier le fichier <code>.gitlab-ci.yml</code> pour ajouter cette nouvelle √©tape. Le fichier final ressemblera alors √† ceci :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> quality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;$CI_JOB_NAME&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mvnw compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dhttps.protocols=TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.showDateTime=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Djava.awt.headless=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fail</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">at</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">end </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">version </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DinstallAtEnd=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DdeployAtEnd=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openjdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mvnw test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dhttps.protocols=TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.showDateTime=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Djava.awt.headless=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fail</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">at</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">end </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">version </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DinstallAtEnd=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DdeployAtEnd=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openjdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">code_quality_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> quality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allow_failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkdir codequality</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">env CODECLIMATE_CODE=&quot;$PWD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume &quot;$PWD&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume /var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume /tmp/cc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/tmp/cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        codeclimate/codeclimate analyze </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f html </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> ./codequality</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> codequality</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">package_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">DOCKER_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> apk add </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker login </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">u gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ci</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">token </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">p $CI_JOB_TOKEN $CI_REGISTRY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mvnw install </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">PbuildDocker </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DskipTests=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DpushImage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dhttps.protocols=TLSv1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dorg.slf4j.simpleLogger.showDateTime=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Djava.awt.headless=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">errors </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fail</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">at</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">end </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">version </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DinstallAtEnd=true </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">DdeployAtEnd=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> openjdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alpine</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>J&#x27;ajoute dans le fichier la derni√®re √©tape de mon pipeline d&#x27;int√©gration continue, l&#x27;√©tape (le <em>stage</em>) <code>package</code>, qui s&#x27;ex√©cutera √† la suite de l&#x27;√©tape <code>quality</code>. J&#x27;ajoute ensuite le job <code>package_job</code> associ√© √† cette √©tape de qualit√©.</p></blockquote><p>Ce job suppl√©mentaire compile le projet et <strong>l&#x27;encapsule dans un conteneur</strong>. Il est ensuite pouss√© sur la registry de GitLab. Nous retrouvons toutes les lignes que nous avons vues pr√©c√©demment. La partie <code>script</code> lance cependant quelques commandes suppl√©mentaires :</p><ul><li>tout d&#x27;abord, nous <strong>installons le client Docker</strong> dans l&#x27;image <code>openjdk:8-alpine</code> afin de pouvoir lancer les commandes propres √† Docker ;</li><li>ensuite, nous <strong>nous connectons sur la registry interne de GitLab</strong> afin de pouvoir pousser les images Docker de fa√ßon s√©curis√©e ;</li><li>enfin, nous <strong>lan√ßons la commande Maven</strong> de cr√©ation de l&#x27;image Docker.</li></ul><p>Ce processus nous permettra, dans la livraison continue, de pouvoir <strong>d√©ployer facilement</strong> le m√™me code sur diff√©rents environnements. Il sert aussi √† figer le code compil√© dans un <strong>package immuable</strong>. De ce fait, nous pouvons facilement red√©ployer le m√™me code compil√© sur n&#x27;importe quel autre environnement. Cela assure que le code ne soit pas modifi√© entre deux environnements, et qu&#x27;un code test√© soit <strong>d√©ploy√© partout de la m√™me fa√ßon</strong>. Les images Docker ainsi packag√©es se retrouvent sur la page de la registry :</p><p><img src="https://user.oc-static.com/upload/2019/05/27/15589802871223_registry.png" alt="Registry GitLab de votre projet, avec les packages du pipeline"></p><p>Nous avons maintenant toutes les √©tapes n√©cessaires pour l&#x27;int√©gration continue. Comme pr√©vu, notre code est <strong>compil√©</strong> en continu, <strong>test√©</strong>, <strong>analys√©</strong> puis <strong>packag√©</strong>, pr√™t √† √™tre d√©ploy√© sur de nouveaux environnements.</p><p><img src="https://user.oc-static.com/upload/2019/05/29/1559125627351_1c3_illus_WHITEBG%20%280-00-17-23%29_4.png" alt="Toutes les √©tapes de l&#x27;int√©gration continue sont impl√©ment√©es ‚úÖ"></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="les-autres-outils-de-lint√©gration-continue">Les autres outils de l&#x27;int√©gration continue<a aria-hidden="true" class="hash-link" href="#les-autres-outils-de-lint√©gration-continue" title="Direct link to heading">‚Äã</a></h3><p>Vous avez donc vu tout au long de cette partie comment mettre en place <strong>l&#x27;int√©gration continue avec GitLab</strong>, mais sachez qu&#x27;il existe d&#x27;autres outils reprenant les m√™mes concepts. Le plus connu et le plus utilis√© d&#x27;entre eux est <a href="https://jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>. Avec cet outil, vous pouvez impl√©menter toutes les √©tapes pr√©c√©demment vues. De plus, Jenkins utilise maintenant un fichier de description comme GitLab, qui s&#x27;appelle <a href="https://jenkins.io/doc/book/pipeline/jenkinsfile/" target="_blank" rel="noopener noreferrer">Jenkinsfile</a>.</p><p>Le principe est strictement le m√™me que <strong>GitLab</strong> : il s&#x27;agit d&#x27;un <strong>fichier de description du pipeline</strong> d&#x27;int√©gration continue qui va contenir toutes les √©tapes √† lancer, afin de garantir que le code compile et soit de qualit√© √† tout moment. Cependant, il est n√©cessaire d&#x27;installer Jenkins dans votre entreprise, de le configurer, de le maintenir et de le mettre √† jour, ce qui peut s&#x27;av√©rer <strong>long et fastidieux</strong>.</p><p>Pour ceux qui ne voudraient pas passer leur temps √† maintenir ce genre d&#x27;outils, il existe aussi d&#x27;autres outils en mode <strong>Software-as-a-Service</strong> (SaaS), o√π la maintenance et l&#x27;√©volution sont garanties par le fournisseur. Ces outils peuvent √™tre mieux adapt√©s pour mettre en place rapidement et sans effort un pipeline d&#x27;int√©gration continue. Les outils les plus connus dans cet √©cosyst√®me sont <a href="https://travis-ci.org/" target="_blank" rel="noopener noreferrer">Travis CI</a> et <a href="https://circleci.com/" target="_blank" rel="noopener noreferrer">CircleCI</a>.</p><p>Le gros avantage de ces outils est que la <strong>maintenance</strong> n&#x27;est pas √† la charge de l&#x27;√©quipe, mais du <strong>fournisseur</strong>. De plus, ces outils peuvent se connecter automatiquement sur Github.com pour la plupart, ce qui √©vite aussi les configurations longues et fastidieuses des diff√©rents outils.</p><p>Enfin, GitHub a sorti une beta de son nouveau service √† destination des d√©veloppeurs, afin de pouvoir impl√©menter rapidement des pipelines d&#x27;int√©gration continue : <strong>GitHub Actions</strong>. Le principe est toujours le m√™me : un fichier <code>.workflow</code> permet de cr√©er un pipeline, afin de compiler et d√©ployer du code sur n&#x27;importe quelle plateforme. L&#x27;avantage principal de GitHub Actions est que ce dernier est directement int√©gr√© dans GitHub.</p><blockquote><p>Nous avons donc rempli les deux derni√®res √©tapes de l&#x27;int√©gration continue :</p><ol><li>‚úÖPlanifiez votre d√©veloppement.</li><li>‚úÖCompilez et int√©grez votre code.</li><li>‚úÖTestez votre code.</li><li>‚úÖMesurez la qualit√© de votre code.</li><li>‚úÖG√©rez les livrables de votre application.</li></ol></blockquote><p>Et voil√† ! Vous avez mis en place toutes les √©tapes de l&#x27;int√©gration continue ! üëèüéâ</p><p><strong>Dans la prochaine partie</strong>, nous mettrons en place la livraison continue, du d√©ploiement √† la supervision, en passant par les tests en production.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="exercice--mettez-en-place-le-pipeline-ci-de-votre-application-avec-gitlab">Exercice ! Mettez en place le pipeline CI de votre application avec GitLab<a aria-hidden="true" class="hash-link" href="#exercice--mettez-en-place-le-pipeline-ci-de-votre-application-avec-gitlab" title="Direct link to heading">‚Äã</a></h2><p>Vous √™tes le nouvel <strong>ing√©nieur DevOps</strong> de l&#x27;entreprise <strong>PetClinic</strong>. L‚Äô√©quipe de d√©veloppement se repose sur un serveur afin de compiler l‚Äôapplication avant la livraison. Cependant, aucun test unitaire n‚Äôest ex√©cut√©, et les clients se plaignent de la mauvaise qualit√© de l‚Äôapplication.</p><p>Votre premi√®re mission est de mettre en place un pipeline d‚Äôint√©gration continue automatis√© afin de compiler l‚Äôapplication, de lancer les tests unitaires associ√©s, et de stocker les livrables sur un serveur afin de pr√©parer le d√©ploiement.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="description">Description<a aria-hidden="true" class="hash-link" href="#description" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="objectif">Objectif<a aria-hidden="true" class="hash-link" href="#objectif" title="Direct link to heading">‚Äã</a></h4><p>L‚Äôobjectif de cette activit√© est <strong>d‚Äô√©crire le pipeline d‚Äôint√©gration continue</strong> n√©cessaire √† l‚Äôint√©gration du projet. Pour cette activit√©, nous utiliserons le projet exemple Java <strong>PetClinic</strong> comme vu dans ce cours, mais dans sa version non microservice.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="donn√©es">Donn√©es<a aria-hidden="true" class="hash-link" href="#donn√©es" title="Direct link to heading">‚Äã</a></h4><p>Les donn√©es sont le <a href="https://github.com/spring-projects/spring-petclinic" target="_blank" rel="noopener noreferrer">repository GitHub du projet Petclinic</a>. Ce repository contient tous les √©l√©ments n√©cessaires au fonctionnement de l‚Äôapplication. Ces √©l√©ments sont :</p><ul><li>le code source ;</li><li>les tests unitaires ;</li><li>la documentation.</li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="instructions">Instructions<a aria-hidden="true" class="hash-link" href="#instructions" title="Direct link to heading">‚Äã</a></h4><p>Clonez le repository dans votre repository GitLab, et mettez en place un pipeline d‚Äôint√©gration continue contenant chacune des √©tapes n√©cessaires √† sa bonne ex√©cution.</p><p>Comme vu dans ce cours, ces √©tapes sont les 4 √©tapes de l‚Äôint√©gration continue : <strong>compilation</strong>, <strong>test</strong>, <strong>qualit√©</strong> et gestion des <strong>livrables</strong> (package + deploy).</p><p>Afin de pouvoir livrer l‚Äôapplication et la stocker sous GitLab, vous aurez besoin de modifier le fichier pom.xml et d&#x27;ajouter un fichier ci-settings.xml √† la racine de votre projet. Pour vous aider, voici les fichiers :</p><ul><li>le <a href="https://s3-eu-west-1.amazonaws.com/course.oc-static.com/courses/2035736/activit%C3%A9/pom.xml" target="_blank" rel="noopener noreferrer">pom.xml</a>, vous pouvez directement remplacer votre pom.xml par celui-ci ;</li><li>le <a href="https://s3-eu-west-1.amazonaws.com/course.oc-static.com/courses/2035736/activit%C3%A9/ci-settings.xml" target="_blank" rel="noopener noreferrer">ci-settings.xml</a> √† ajouter √† la racine de votre projet.</li></ul><p>Ces fichiers doivent contenir le n√©cessaire afin de pouvoir s‚Äôauthentifier aupr√®s du repository de GitLab, ainsi qu‚Äôavoir les droits n√©cessaires pour envoyer le livrable g√©n√©r√©. Pour ceci, vous pouvez vous inspirer de <a href="https://docs.gitlab.com/ee/user/project/packages/maven_repository.html" target="_blank" rel="noopener noreferrer">la page officielle de GitLab</a>.</p><p>Une image Docker a √©t√© pr√©par√©e pour vous afin de faciliter toutes les √©tapes de l&#x27;int√©gration continue, et contenant tous les outils n√©cessaires au bon d√©roulement des √©tapes.</p><p>Une fois toutes les √©tapes valid√©es, <strong>une phrase sera affich√©e</strong> dans les logs de l&#x27;√©tape de d√©ploiement. C&#x27;est en voyant cette phrase que vous saurez que vous avez r√©ussi cette mission !</p><p>Le nom de l&#x27;image √† utiliser dans le <code>.gitlab-ci.yml</code> est l&#x27;image <code>laurentgrangeau/oc-devops:latest</code></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="question">Question<a aria-hidden="true" class="hash-link" href="#question" title="Direct link to heading">‚Äã</a></h3><p>Quelle est la phrase affich√©e lors de l&#x27;√©tape de d√©ploiement ?</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="r√©ponse">R√©ponse<a aria-hidden="true" class="hash-link" href="#r√©ponse" title="Direct link to heading">‚Äã</a></h3><details class="details_2Ziz alert alert--info details_1VDD" data-collapsed="true"><summary>Voir la r√©ponse</summary><div><div class="collapsibleContent_3OHp">Something small enough to escape casual notice.</div></div></details><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="quest-ce-que-la-livraison-continue-">Qu&#x27;est-ce que la livraison continue ?<a aria-hidden="true" class="hash-link" href="#quest-ce-que-la-livraison-continue-" title="Direct link to heading">‚Äã</a></h2><p><strong>La livraison continue</strong> est la suite logique de l&#x27;int√©gration continue. Dans l&#x27;int√©gration continue, nous cherchons √† ce que le code <strong>compile</strong> bien, mais aussi qu&#x27;il soit <strong>fonctionnel</strong> en production et de <strong>qualit√©</strong>, en lan√ßant le plus r√©guli√®rement possible les <strong>tests unitaires</strong>. Mais il existe d&#x27;autres <strong>types</strong> de tests, tout aussi importants, pour garantir la qualit√© du code. Ces tests ne peuvent cependant pas √™tre lanc√©s sans avoir un environnement d√©ploy√©.</p><blockquote><p>Attention, la <strong>livraison continue</strong> ne doit pas √™tre confondue avec le <strong>d√©ploiement continu</strong>, qui est la suite logique de la livraison continue. Ces deux disciplines ont comme objectif de d√©ployer une application en production. La diff√©rence se trouve dans l&#x27;automatisation du d√©ploiement en production. La livraison continue s&#x27;arr√™te avant la production, et la mise en production reste un acte manuel (que ce soit avec un outil, ou automatis√© via un clic de bouton, ou bien manuellement). La mise en production est soumise alors √† la <strong>validation d&#x27;un √™tre humain</strong>. <br><br>
Le <strong>d√©ploiement continu</strong>, quant √† lui, est l&#x27;extension de la livraison continue : le d√©ploiement se fait de mani√®re <strong>automatis√©e</strong> par un pipeline. Toutes les √©tapes de compilation, tests unitaires et autres tests automatis√©s doivent √™tre alors au vert avant de proc√©der au d√©ploiement.</p></blockquote><p>La <strong>livraison continue</strong> est une discipline o√π l&#x27;application est construite de mani√®re √† pouvoir √™tre mise en production √† n&#x27;importe quel moment.</p><p>Pour atteindre la mise en oeuvre de la livraison continue sur une application, il est n√©cessaire de mettre en place plusieurs √©tapes suppl√©mentaires au sein de notre pipeline.</p><blockquote><p>Pour mettre en place la <strong>livraison continue</strong>, vous devez mettre en place <strong>5 √©tapes</strong> :</p><ol><li>La codification de l&#x27;infrastructure avec l&#x27;<strong>Infrastructure-as-Code</strong>.</li><li>Le <strong>d√©ploiement</strong> de votre application.</li><li>Le <strong>test</strong> de votre application en environnement de test.</li><li>La <strong>supervision</strong> de l&#x27;application.</li><li>La mise en place de <strong>notifications</strong> d&#x27;alerte.</li></ol></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-1--codifiez-votre-infrastructure-avec-linfrastructure-as-code">√âtape 1 : Codifiez votre infrastructure avec l&#x27;Infrastructure-as-Code<a aria-hidden="true" class="hash-link" href="#√©tape-1--codifiez-votre-infrastructure-avec-linfrastructure-as-code" title="Direct link to heading">‚Äã</a></h3><blockquote><p>L&#x27;<strong>Infrastructure-as-Code</strong> est une pratique qui consiste √† <strong>d√©crire une infrastructure avec du code</strong>. Ce code est alors stock√© avec le code de l&#x27;application, et fait partie int√©grante de cette derni√®re.</p></blockquote><p>Les avantages sont nombreux :</p><ul><li>possibilit√© de cr√©er des environnements <strong>√† la demande</strong> ;</li><li><strong>cr√©ation d&#x27;environnement en quelques minutes</strong>, contre plusieurs semaines dans une entreprise classique ;</li><li><strong>pilotage de l&#x27;infrastructure</strong> gr√¢ce au pipeline de livraison continue ;</li><li><strong>connaissance des logiciels</strong> install√©s sur la plateforme, gr√¢ce √† l&#x27;outillage ;</li><li><strong>mont√©e de version</strong> des environnements automatis√©s.</li></ul><blockquote><p>Les outils principaux de l&#x27;Infrastructure-as-Code sont <strong>Docker</strong>, <strong>Chef</strong>, <strong>Puppet</strong>, <strong>Ansible</strong> et <strong>Terraform</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-2--d√©ployez-votre-application">√âtape 2 : D√©ployez votre application<a aria-hidden="true" class="hash-link" href="#√©tape-2--d√©ployez-votre-application" title="Direct link to heading">‚Äã</a></h3><p>L&#x27;√©tape la plus importante de la livraison continue est le <strong>d√©ploiement du package</strong> que nous avons pr√©c√©demment cr√©√© lors de l&#x27;int√©gration continue. Les avantages d&#x27;utiliser un outil pour <strong>automatiser le d√©ploiement</strong> de l&#x27;application sont nombreux :</p><ul><li>cela permet √† l&#x27;√©quipe de <strong>se concentrer sur le d√©veloppement</strong>, l√† o√π elle a sa valeur √† ajouter ;</li><li>n&#x27;importe qui dans l&#x27;√©quipe peut d√©ployer des logiciels ;</li><li>les d√©ploiements deviennent beaucoup moins sujets aux <strong>erreurs</strong> et beaucoup plus <strong>reproductibles</strong> ;</li><li>d√©ployer sur un <strong>nouvel environnement</strong> est facile ;</li><li>les d√©ploiements peuvent √™tre <strong>tr√®s fr√©quents</strong>.</li></ul><blockquote><p>Pour pouvoir d√©ployer les artefacts pr√©c√©demment cr√©√©s, vous pourrez utiliser <strong>Spinnaker</strong>, <strong>XLDeploy</strong> ou <strong>UrbanCode</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-3--testez-votre-application">√âtape 3 : Testez votre application<a aria-hidden="true" class="hash-link" href="#√©tape-3--testez-votre-application" title="Direct link to heading">‚Äã</a></h3><p>C&#x27;est dans cette √©tape que nous allons ajouter <strong>d&#x27;autres types de tests</strong>, plus pertinents et plus fonctionnels, afin de garantir que l&#x27;application <strong>fonctionne comme nous l&#x27;avons estim√©</strong>.</p><p>L&#x27;avantage de tester √† ce stade du pipeline est que l&#x27;application tourne sur un environnement de test, <strong>presque identique √† celui de la production</strong>. Son comportement sera donc le plus fid√®le possible √† celui qu&#x27;elle aura en production.</p><p>Ces tests peuvent √™tre de diff√©rents types :</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="test-dacceptance">Test d&#x27;acceptance<a aria-hidden="true" class="hash-link" href="#test-dacceptance" title="Direct link to heading">‚Äã</a></h4><p>Les <strong>tests d&#x27;acceptance</strong> sont des tests formels ex√©cut√©s pour v√©rifier si un syst√®me satisfait √† ses exigences op√©rationnelles. Ils exigent que l&#x27;application enti√®re soit op√©rationnelle et se concentrent sur la r√©plication des comportements des utilisateurs. Mais ils peuvent aussi aller plus loin en mesurant la performance du syst√®me, et rejeter les changements si certains objectifs ne sont pas atteints.</p><p>Ces tests peuvent √™tre <strong>automatis√©s</strong>, mais aussi <strong>manuels</strong>, avec une √©quipe de test d√©di√©e qui regardera si le logiciel correspond au besoin.</p><blockquote><p>Pour lancer des tests d&#x27;acceptance, vous pourrez utiliser <strong>Confluence</strong>, <strong>FitNesse</strong> ou <strong>Ranorex</strong>.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_31ik" id="test-de-performance">Test de performance<a aria-hidden="true" class="hash-link" href="#test-de-performance" title="Direct link to heading">‚Äã</a></h4><p>Les <strong>tests de performance</strong> v√©rifient le comportement du syst√®me lorsqu&#x27;il est soumis √† une charge importante. Ces tests ne sont pas fonctionnels et peuvent prendre diff√©rentes formes pour comprendre la fiabilit√©, la stabilit√© et la disponibilit√© de la plateforme. Par exemple, il peut s&#x27;agir d&#x27;observer les temps de r√©ponse lors de l&#x27;ex√©cution d&#x27;un grand nombre de requ√™tes, ou de voir comment le syst√®me se comporte avec une quantit√© importante de donn√©es.</p><p>Les tests de performance sont par nature assez co√ªteux √† mettre en ≈ìuvre et √† ex√©cuter, mais ils peuvent vous aider √† comprendre si de nouveaux changements vont d√©grader votre syst√®me.</p><blockquote><p>Pour faire des tests de performance, vous pourrez utiliser <strong>JMeter</strong>, <strong>Apache Bench</strong> ou <strong>Gatling</strong>.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_31ik" id="smoke-test">Smoke test<a aria-hidden="true" class="hash-link" href="#smoke-test" title="Direct link to heading">‚Äã</a></h4><p>Les <strong>smoke tests</strong> sont des tests de base qui v√©rifient les fonctionnalit√©s de base de l&#x27;application. Ils sont con√ßus pour √™tre rapides √† ex√©cuter, et leur but est de vous donner l&#x27;assurance que les <strong>principales caract√©ristiques de votre syst√®me fonctionnent comme pr√©vu</strong>. Ils peuvent √™tre utiles juste apr√®s une nouvelle build, pour d√©cider si vous pouvez ou non ex√©cuter des tests plus co√ªteux, ou juste apr√®s un d√©ploiement pour s&#x27;assurer que l&#x27;application fonctionne correctement dans le nouvel environnement d√©ploy√©.</p><p>Par exemple, les smoke tests peuvent s&#x27;assurer que la base de donn√©es r√©pond et est correctement configur√©e, mais aussi que les diff√©rents composants sont pr√©sents et envoient des donn√©es correctes, comme des API qui devraient r√©pondre un code HTTP 200, ou une page web qui devrait s&#x27;afficher.</p><blockquote><p>Pour s&#x27;assurer du bon fonctionnement de l&#x27;application, vous pourrez utiliser <strong>Selenium</strong>, <strong>SoapUI</strong> ou <strong>Cypress</strong>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-4--supervisez-le-comportement-de-votre-application">√âtape 4 : Supervisez le comportement de votre application<a aria-hidden="true" class="hash-link" href="#√©tape-4--supervisez-le-comportement-de-votre-application" title="Direct link to heading">‚Äã</a></h3><p>Le <strong>monitoring</strong>, ou <strong><em>supervision</em></strong>, intervient une fois que notre application est d√©ploy√©e sur un environnement, que ce soit un environnement de <strong>staging</strong>, de <strong>test</strong>, de <strong>d√©monstration</strong> ou bien l&#x27;environnement de <strong>production</strong> lui-m√™me.</p><p>Le principe est de <strong>r√©cup√©rer certaines m√©triques</strong> qui ont du sens pour ceux qui interviennent sur l&#x27;application. Cela peut √™tre par exemple le nombre de connexions HTTP, le nombre de requ√™tes √† la base de donn√©es, le temps de r√©ponse de certaines pages ; mais aussi des m√©triques plus orient√©es m√©tier, comme le chiffre d&#x27;affaires g√©n√©r√©, ou le nombre de personnes inscrites sur l&#x27;application.</p><blockquote><p>Pour avoir un monitoring de vos applications, vous pourrez utiliser la suite <strong>Elastic</strong>, <strong>Prometheus</strong> ou <strong>Graylog</strong>.</p></blockquote><p>Les m√©triques peuvent √™tre aussi sur la partie livraison en elle-m√™me, ou sur le processus de d√©veloppement. Par exemple, l&#x27;√©quipe peut mesurer le nombre de d√©ploiements qu&#x27;elle effectue par jour, ou encore deux autres indicateurs qui sont importants afin de voir la performance de l&#x27;√©quipe sur la correction d&#x27;erreurs qui peuvent survenir en production :</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="le-mean-time-between-failure">Le Mean-Time-Between-Failure<a aria-hidden="true" class="hash-link" href="#le-mean-time-between-failure" title="Direct link to heading">‚Äã</a></h4><p>Le <strong>Mean-Time-Between-Failure</strong> (ou MTBF) est le temps moyen qui s√©pare deux erreurs en production. Plus ce temps est √©lev√©, plus le syst√®me est stable et fiable, notamment du fait de la qualit√© des tests qui sont jou√©s lors de la livraison continue.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="le-mean-time-to-recover">Le Mean-Time-To-Recover<a aria-hidden="true" class="hash-link" href="#le-mean-time-to-recover" title="Direct link to heading">‚Äã</a></h4><p>Le <strong>Mean-Time-To-Recover</strong> (ou MTTR) est le temps moyen de correction entre deux erreurs de production. Plus ce temps est faible, plus l&#x27;√©quipe est apte √† d√©tecter des erreurs et √† les corriger rapidement.</p><blockquote><p>Des outils comme <strong>Dynatrace</strong>, <strong>Sysdig</strong> ou <strong>New Relic</strong> permettent d&#x27;avoir ces m√©triques.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_31ik" id="√©tape-5--mettez-en-place-des-notifications-dalertes">√âtape 5 : Mettez en place des notifications d&#x27;alertes<a aria-hidden="true" class="hash-link" href="#√©tape-5--mettez-en-place-des-notifications-dalertes" title="Direct link to heading">‚Äã</a></h3><p>La premi√®re version d&#x27;une nouvelle fonctionnalit√© ou d&#x27;un nouveau produit ne couvre souvent pas enti√®rement les besoins des clients. M√™me lorsque l&#x27;√©quipe passe des semaines ou des mois √† construire quelque chose, le produit final est souvent vou√© √† manquer des fonctionnalit√©s importantes. C&#x27;est le principe du <strong>Minimum Viable Product</strong> (MVP) en Agile.</p><p>Il arrive donc tr√®s souvent de livrer des logiciels <strong>incomplets ou bugg√©s</strong>, si l&#x27;√©quipe veut aller assez vite. Au lieu de vouloir √©viter cela, il est n√©cessaire d&#x27;adopter l&#x27;id√©e de <strong>livrer des petites pi√®ces de valeur</strong>.</p><p>En livrant <strong>plus vite</strong>, nous pouvons r√©parer les bugs <strong>tant que les livraisons restent petites</strong>, et que nous savons ce qui a √©t√© modifi√© dans l&#x27;application. Quand les d√©veloppements grossissent, ils deviennent plus difficiles √† g√©rer et √† remanier. Un feedback rapide, gr√¢ce aux <strong>tests en production</strong> et au <strong>monitoring</strong>, permet d&#x27;intervenir et de corriger le probl√®me d√®s que possible. Il nous permet d&#x27;apprendre des clients, et des erreurs, au bon moment.</p><p>Une fois le d√©ploiement fini et les diff√©rents tests effectu√©s, il est n√©cessaire d&#x27;avoir un feedback rapide de l&#x27;utilisation du logiciel. En effet, si le d√©ploiement de la nouvelle version du logiciel apporte des bugs malgr√© les diff√©rents tests effectu√©s, il faut alors les d√©tecter le plus rapidement possible, afin de pouvoir proposer une nouvelle correction au logiciel.</p><blockquote><p>Pour avoir un feedback rapide de vos d√©ploiements, vous pourrez tout simplement utiliser <strong>Slack</strong>, <strong>Trello</strong> ou <strong>Twitter</strong>. </p></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="codifiez-votre-infrastructure">Codifiez votre infrastructure<a aria-hidden="true" class="hash-link" href="#codifiez-votre-infrastructure" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="construisez-les-images-de-votre-application-avec-docker">Construisez les images de votre application avec Docker<a aria-hidden="true" class="hash-link" href="#construisez-les-images-de-votre-application-avec-docker" title="Direct link to heading">‚Äã</a></h3><p>Notre application PetClinic est construite √† partir de fichiers, nomm√©s <code>dockerfiles</code>, d√©j√† pr√©sents dans le contr√¥le de code source. Ces <code>dockerfiles</code> sont pr√©sents dans le r√©pertoire <code>Docker</code> du projet et contiennent les lignes suivantes :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Dockerfile"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">FROM openjdk:8-jre-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VOLUME /tmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG DOCKERIZE_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG ARTIFACT_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG EXPOSED_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV SPRING_PROFILES_ACTIVE docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN tar xzf dockerize.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN chmod +x dockerize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD ${ARTIFACT_NAME}.jar /app.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN touch /app.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE ${EXPOSED_PORT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT [&quot;java&quot;, &quot;-XX:+UnlockExperimentalVMOptions&quot;, &quot;-XX:+UseCGroupMemoryLimitForHeap&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Ce <code>dockerfile</code> part d&#x27;une image qui contient d√©j√† <strong>la version 8 de Java</strong> et copie tous les .jar des diff√©rents projets, afin de construire les diff√©rentes images associ√©es. Enfin, la derni√®re √©tape de ce <code>dockerfile</code> est de lancer la commande <code>Java</code> avec le jar associ√©.</p><p>Dans cette partie du cours, vous allez modifier le <code>dockerfile</code> pour voir l&#x27;impact de l&#x27;Infrastructure-as-Code sur votre pipeline de d√©ploiement. Pour ce faire, ouvrez le fichier <code>Dockerfile</code> pr√©sent dans le dossier Docker, afin de modifier la version du runtime de Java en version <code>openjdk:13-alpine</code> :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586191895254_change-openjdk.png" alt="Changez la version de l&#x27;openjdk dans le dockerfile"></p><p>Avant de pousser ce fichier sur Git, vous allez modifier la version de release de chaque <code>pom.xml</code> pr√©sent dans le projet, pour incr√©menter le num√©ro de version des images Docker cr√©√©es, et ainsi ne pas √©craser les versions pr√©c√©demment build√©es :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586192536832_modify-pom.png" alt="Changez la version des images Docker cr√©√©es dans les fichiers pom.xml"></p><p><strong>Il y a plusieurs <code>pom.xml</code> o√π il faut ajouter le bon num√©ro de version !</strong></p><p>Une fois ces modifications faites, poussez les fichiers sur Git :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit -m </span><span class="token string" style="color:#e3116c">&quot;Modification de la version de Java et incr√©mentation du num√©ro de version&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin master</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Le pipeline d&#x27;int√©gration continue devrait se lancer :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586193101822_pipeline-launch.png" alt="Le pipeline se lance √† nouveau"></p><p>Et la registry Docker devrait contenir les nouvelles images build√©es gr√¢ce au pipeline.</p><p>Vous venez de voir √† quel point l&#x27;<strong>Infrastructure-as-Code</strong> est pratique pour tester rapidement le changement de version d&#x27;un framework, ou le changement de version d&#x27;un middleware comme Apache ou IIS. En ne changeant que quelques lignes, nous pouvons alors relancer tout le pipeline, afin de voir s&#x27;il y a un impact sur le code applicatif.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="d√©ployez-votre-application-avec-docker-compose">D√©ployez votre application avec Docker Compose<a aria-hidden="true" class="hash-link" href="#d√©ployez-votre-application-avec-docker-compose" title="Direct link to heading">‚Äã</a></h3><p>L&#x27;Infrastructure-as-Code ne s&#x27;arr√™te pas l√†. Dans le cas de Docker, toute l&#x27;application peut √™tre d√©ploy√©e gr√¢ce au fichier <code>docker-compose.yml</code> qui contient toute la d√©finition de l&#x27;application, la relation entre les images Docker et le sens de d√©marrage de celles-ci.</p><p>Le fichier <code>docker-compose.yml</code> pr√©sent dans le repository Git d√©finit des images en dur. Vous allez <strong>remplacer le nom des images par les nouvelles images que vous venez de cr√©er</strong>.</p><p>Remplacez alors toutes les lignes contenant <code>mszarlinski/</code> par votre nom de registry (chez moi, <code>registry.gitlab.com/laurentgrangeau/</code>). De plus, ajoutez aussi en bout de ligne le num√©ro de version de l&#x27;image que vous venez de cr√©er <code>:2.0.7</code></p><p>Le fichier <code>docker-compose.yml</code> devrait ressembler √† ceci (le fichier est volontairement tronqu√©) :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">graf-data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">config-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.gitlab.com/laurentgrangeau/spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">petclinic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices/spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">petclinic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">2.0.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mem_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 512M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8888</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">discovery-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.gitlab.com/laurentgrangeau/spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">petclinic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices/spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">petclinic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">discovery</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">2.0.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> discovery</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mem_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 512M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">entrypoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;./dockerize&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-wait=tcp://config-server:8888&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-timeout=120s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;java&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-XX:+UnlockExperimentalVMOptions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-XX:+UseCGroupMemoryLimitForHeap&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;-jar&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;/app.jar&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8761</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8761</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Et voil√†, vos fichiers Docker et Docker Compose sont pr√™ts √† √™tre lanc√©s par votre pipeline de livraison continue.</p><blockquote><p>Nous avons donc rempli la premi√®re √©tape de la livraison continue : </p><ol><li>‚úÖLa codification de l&#x27;infrastructure avec l&#x27;<strong>Infrastructure-as-Code</strong>.</li><li>Le <strong>d√©ploiement</strong> de votre application.</li><li>Le <strong>test</strong> de votre application en environnement de test.</li><li>La <strong>supervision</strong> de l&#x27;application.</li><li>La mise en place de <strong>notifications</strong> d&#x27;alerte.</li></ol></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="d√©ployez-et-testez-votre-code-sur-diff√©rents-environnements">D√©ployez et testez votre code sur diff√©rents environnements<a aria-hidden="true" class="hash-link" href="#d√©ployez-et-testez-votre-code-sur-diff√©rents-environnements" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="pr√©parez-votre-environnement-de-travail">Pr√©parez votre environnement de travail<a aria-hidden="true" class="hash-link" href="#pr√©parez-votre-environnement-de-travail" title="Direct link to heading">‚Äã</a></h3><p>Afin de vous faciliter la t√¢che et de ne pas installer des d√©pendances inutiles, je vous conseille de cr√©er un environnement sur le site <a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener noreferrer">Play-With-Docker</a>. Ce site va vous permettre de cr√©er une infrastructure Docker rapidement. Rendez-vous sur le site, et connectez-vous avec vos identifiants Docker Hub.</p><p>Une fois connect√©, une session de 4 heures est cr√©√©e afin de vous permettre de d√©ployer vos images. Sur la page d&#x27;accueil, cliquez sur l&#x27;ic√¥ne üîß et s√©lectionnez le template <strong>3 Managers and 2 Workers</strong>.</p><p>Cela va vous cr√©er un cluster Docker Swarm, n√©cessaire au d√©ploiement des images. Une fois le cluster cr√©√©, vous allez r√©cup√©rer l&#x27;URL de l&#x27;environnement. Il suffit de copier l&#x27;URL pr√©sente dans la case SSH.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586194362038_pwd-ssh.png" alt="Copiez l&#x27;URL SSH de votre Docker Swarm sur le Play-With-Docker"></p><p>Cette URL sera utilis√©e pour configurer l&#x27;environnement de d√©ploiement dans le fichier <code>.gitlab-ci.yml</code>. Maintenant, modifiez ce fichier pour ajouter deux nouvelles lignes. La premi√®re ligne √† ajouter est au niveau de <code>variables</code>. Cette nouvelle variable va contenir l&#x27;URL copi√©e pr√©c√©demment (<code>ip172-18-0-51-bihm1906chi000b37l6g</code> chez moi) :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">PWD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ip172</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">18</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">51</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bihm1906chi000b37l6g</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>La deuxi√®me ligne est √† ajouter juste apr√®s l&#x27;√©tape <code>package</code>. Cette √©tape suppl√©mentaire sera le d√©ploiement des images sur un environnement de staging :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">deploy_staging_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> apk add </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache openssh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client py</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pip python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev libffi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev openssl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev gcc libc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pip install docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> export DOCKER_HOST=tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose up </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8080.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>La syntaxe est la m√™me que les pr√©c√©dentes √©tapes. Dans la partie script, nous avons ajout√© la copie du fichier <code>docker-compose.yml</code>, ainsi que le dossier <code>docker</code>. Enfin, nous d√©marrons le projet gr√¢ce √† Docker Compose.</p><p>Si tout s&#x27;est bien pass√©, vous devriez voir appara√Ætre dans vos environnements (<em>Op√©rations &gt; Environnements</em>), le nouvel environnement <strong>Staging</strong>.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586195611102_env-staging.png" alt="Votre nouvel environnement de staging"></p><p>Vous pouvez alors cliquer sur le lien &quot;<em>Open live environment</em>&quot; sur la droite de cet environnement, afin de voir l&#x27;application d√©ploy√©e.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586196079905_petclinic.png" alt="Votre application d√©ploy√©e"></p><p>Maintenant que l&#x27;environnement <strong>Staging</strong> est d√©ploy√©, il est possible de lancer des tests impossibles √† lancer lors de la phase d&#x27;int√©gration continue. Dans ce cours, nous allons lancer un test de performance, afin de mesurer les temps de r√©ponse de l&#x27;application. Pour ce faire, vous allez utiliser Apache Benchmark pour simuler de la charge sur le serveur.</p><p>Il faut alors ajouter de nouvelles lignes dans le fichier <code>.gitlab-ci.yml</code>, afin de lancer les tests de performance sur le nouvel environnement :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">performance_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8080.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> apk add </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> x=1; while </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> &quot;$(curl </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">s </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">o /dev/null </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">w &#x27;&#x27;%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">http_code</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&#x27;&#x27; http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8080.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com/)&quot; </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &quot;200&quot; </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> $x </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">le 60 </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">; do sleep 5; echo $(( x++ )); done </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkdir gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> wget </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">O ./gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter/index.js https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//gitlab.com/gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">org/gl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">performance/raw/master/index.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkdir sitespeed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker run </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">size=1g </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">rm </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">v &quot;$(pwd)&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/sitespeed.io sitespeedio/sitespeed.io</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">6.3.1 </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugins.add ./gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">outputFolder sitespeed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results $URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mv sitespeed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results/data/performance.json performance.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sitespeed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">reports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">performance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> performance.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Dans ce nouveau bloc, la syntaxe reste la m√™me. Nous r√©cup√©rons dans un premier temps l&#x27;utilitaire de test de performance dans le bloc <code>script</code>. Nous lan√ßons ensuite une application qui va se charger de tester notre site et d&#x27;en extraire des m√©triques de performance. Ces m√©triques sont ensuite upload√©es sur GitLab afin d&#x27;√™tre accessibles.</p><p>Ensuite, modifiez aussi le d√©but du fichier afin d&#x27;ajouter une nouvelle ligne dans le bloc <code>stages</code> :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> quality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> performance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Enfin, une fois l&#x27;environnement de staging d√©ploy√© et test√©, il ne reste plus qu&#x27;√† d√©ployer l&#x27;application sur l&#x27;environnement de production. Pour cela, vous allez une nouvelle fois modifier le fichier <code>.gitlab-ci.yml</code> afin d&#x27;ajouter l&#x27;√©tape de mise en production :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">deploy_prod_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> apk add </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache openssh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client py</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pip python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev libffi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev openssl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev gcc libc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pip install docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> export DOCKER_HOST=tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose up </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8080.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> manual</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Dans cette √©tape, nous ajoutons le mot cl√© <code>when: manual</code> afin de ne d√©ployer en production qu&#x27;avec l&#x27;intervention d&#x27;un √™tre humain. La validation est requise afin de savoir s&#x27;il existe des erreurs lors du d√©ploiement sur <strong>staging</strong>. Si des erreurs existent, il n&#x27;y aura alors pas de mise en production.</p><p>Sur votre pipeline de livraison continue, le d√©ploiement manuel est symbolis√© par l&#x27;ic√¥ne ‚ñ∂Ô∏è √† c√¥t√© de l&#x27;√©tape <code>deploy_prod</code> :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586196445312_manual-deploy.png" alt="Le d√©ploiement manuel sur GitLab CI"></p><p>Ces erreurs seront analys√©es lors de la prochaine √©tape : le <strong>monitoring</strong>.</p><p>Enfin, une technique largement utilis√©e lors de l&#x27;utilisation de la livraison continue est le <strong>Canary Release</strong>. Le principe du <strong>Canary Release</strong> est le m√™me que dans les mines de charbon. √Ä l&#x27;√©poque, les mineurs de charbon qui descendait √† la mine pla√ßaient un canari devant eux, au bout d&#x27;une perche dans une cage. Si le canari mourait, cela voulait dire que l&#x27;air √©tait non respirable et les mineurs avaient le temps de rebrousser chemin afin d&#x27;√©viter un sort fatal.</p><p>Le principe est le m√™me dans le d√©ploiement : une partie seulement des utilisateurs vont √™tre redirig√©s vers la nouvelle version de production, et si quelque chose se passe mal, il n&#x27;y aura uniquement qu&#x27;une petite partie des utilisateurs qui sera impact√©e. Pour le mettre en place sur notre projet, modifiez le fichier <code>.gitlab-ci.yml</code> en ajoutant un nouveau bloc <code>canary</code> :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">canary_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> canary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> apk add </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache openssh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client py</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pip python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev libffi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev openssl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev gcc libc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pip install docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> export DOCKER_HOST=tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose up </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$PLAYWD</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8080.direct.labs.play</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">with</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> manual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">only</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> master</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Le principe ici est exactement le m√™me que la production, la diff√©rence √©tant que le d√©ploiement en canary est d√©corr√©l√© de la production.</p><p>Ensuite, modifiez le d√©but du fichier afin que dans le bloc <code>stages</code> soit ajout√©e l&#x27;√©tape <code>canary</code> :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> quality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> canary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> performance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Nous avons maintenant un environnement qui se d√©ploie en parall√®le de la production, et qui contient uniquement une sous-partie des utilisateurs. Cet environnement sera tr√®s utile afin de faire des analyses en temps r√©el du comportement de l&#x27;application, et voir s&#x27;il n&#x27;y a pas d&#x27;erreurs.</p><p>Nous avons maintenant un pipeline complet de livraison continue, de la compilation du projet au d√©ploiement sur un environnement de <strong>staging</strong>, une possibilit√© de d√©ploiement en production via l&#x27;intervention d&#x27;une personne de l&#x27;√©quipe d&#x27;ops, par exemple, et un environnement Canary qui contient un sous-ensemble des utilisateurs, afin de voir comment se comporte l&#x27;application.</p><blockquote><p>Nous avons donc rempli les √©tapes 2 et 3 de la livraison continue :  </p><ol><li>‚úÖLa codification de l&#x27;infrastructure avec l&#x27;<strong>Infrastructure-as-Code</strong>.</li><li>‚úÖLe <strong>d√©ploiement</strong> de votre application.</li><li>‚úÖLe <strong>test</strong> de votre application en environnement de test.</li><li>La <strong>supervision</strong> de l&#x27;application.</li><li>La mise en place de <strong>notifications</strong> d&#x27;alerte.</li></ol></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="monitorez-votre-application">Monitorez votre application<a aria-hidden="true" class="hash-link" href="#monitorez-votre-application" title="Direct link to heading">‚Äã</a></h2><p>Afin de savoir si le d√©ploiement d&#x27;un syst√®me s&#x27;est bien d√©roul√©, il est n√©cessaire de le monitorer, ou le <strong>superviser</strong>. Cela permet de <strong>prendre des d√©cisions</strong> plus rapides, comme le rollback automatique d&#x27;une application si celle-ci ne fonctionne pas.</p><p><strong>Les deux derni√®res √©tapes</strong> de notre pipeline de livraison continue sont donc le <strong>monitoring</strong> de l&#x27;application, afin de savoir si celle-ci fonctionne correctement, ou pr√©sente des erreurs, ainsi que l&#x27;activation de notifications en cas de probl√®me, pour avoir un <strong>feedback rapide</strong>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="supervisez-votre-application-avec-prometheus">Supervisez votre application avec Prometheus<a aria-hidden="true" class="hash-link" href="#supervisez-votre-application-avec-prometheus" title="Direct link to heading">‚Äã</a></h3><p>Dans cette section, vous allez ajouter dans GitLab la r√©cup√©ration des m√©triques de l&#x27;application. Lors du d√©ploiement de l&#x27;application, des m√©triques sont expos√©es par <strong>Prometheus</strong>, qui est un des composants de notre stack technique.</p><p>Le serveur Prometheus est accessible sur le port 9091, auquel vous pouvez acc√©der en cliquant sur le num√©ro de port 9091 qui est apparu sur le site Play-with-Docker :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586223806345_pwd-prometheus.png" alt="Acc√©dez √† Prometheus via le Play-with-Docker"></p><p>Ce serveur Prothemeus r√©cup√®re √©norm√©ment de m√©triques de l&#x27;application, des syst√®mes sous-jacents, ainsi que des images Docker, comme le nombre de connexions par seconde, le nombre de connexions total, etc. Il expose aussi des m√©triques applicatives, comme le nombre d&#x27;animaux cr√©√©s ou mis √† jour.</p><p>Pour r√©cup√©rer ces m√©triques dans GitLab, il suffit d&#x27;aller dans le menu <strong>Settings</strong>, <strong>Integrations</strong>, puis <strong>Prometheus</strong>.</p><p>Ensuite, il faut activer l&#x27;int√©gration avec Prometheus, et le configurer. Cochez la case <strong>Active</strong>, renseignez l&#x27;URL du serveur Prometheus ; dans mon cas : <code>http://ip172-18-0-8-biiabu86chi000em9j9g-9091.direct.labs.play-with-docker.com/</code>et sauvegardez :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586225480542_prometheus.png" alt="Configurez Prometheus"></p><p>Nous allons ensuite d√©finir une m√©trique que nous allons suivre, afin de voir si l&#x27;application √† un probl√®me. Cliquez alors sur <strong>New Metric</strong> et ajoutez les informations suivantes :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586226004055_new-metric.png" alt="Configurez une nouvelle m√©trique sur Prometheus"></p><p>GitLab va alors r√©cup√©rer la m√©trique <code>http_server_requests_seconds_count</code> depuis le serveur Prometheus, et l&#x27;ajouter dans sa base de donn√©es interne. Suite √† cela, nous pouvons alors voir les graphes de ces m√©triques dans le menu <strong>Operations</strong>, puis <strong>Metrics</strong> o√π nous avons l&#x27;√©volution des connexions HTTP au fur et √† mesure du temps :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/1558622656011_metrics.png" alt="Observez vos m√©triques"></p><p>Ces m√©triques sont tr√®s utiles pour prendre des d√©cisions sur le d√©ploiement en production. Ici, nous voyons que les connexions HTTP se font bien, et nous sommes donc confiants sur la mise en production.</p><p>D&#x27;autres types de m√©triques sont aussi accessibles via GitLab, afin de prendre des d√©cisions et voir la productivit√© de l&#x27;√©quipe.</p><p>Par exemple, lors du pr√©c√©dent chapitre, vous avez d√©ploy√© un environnement Canary afin d&#x27;analyser le comportement de l&#x27;application. Pour voir comment cet environnement se comporte et si celui-ci est viable, allez dans le menu <strong>Operations</strong>, puis <strong>Environments</strong>. Vous devriez voir votre nouvel environnement <code>canary</code> et voir les m√©triques associ√©es :</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586227065086_canary.png" alt="Les m√©triques associ√©es √† Canary"></p><p>Pour voir la performance et la productivit√© de l&#x27;√©quipe, GitLab int√®gre aussi des m√©triques concernant le code, les issues, ou encore le temps d&#x27;ex√©cution des tests. Ces diff√©rentes m√©triques sont disponibles dans le menu Project, sous-menu Cycle Analytics.</p><p>Les m√©triques les plus int√©ressantes sont celles qui fournissent des indicateurs sur la v√©locit√© et la productivit√© de l&#x27;√©quipe. Par exemple, il est possible de voir <strong>le temps entre la cr√©ation d&#x27;une issue et sa r√©solution</strong> dans la rubrique Review.</p><p>Il est possible de voir aussi le temps de d√©ploiement sur les diff√©rents environnements. Plus cette valeur est petite, plus il est facile de d√©ployer sur les environnements. Par exemple, dans l&#x27;exemple ci-dessous, le temps de d√©ploiement sur l&#x27;environnement de Staging est de 3 minutes en moyenne. Avec un temps de d√©ploiement aussi court, il est facile de d√©ployer une correction en production assez rapidement.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/1558622961915_metrics-staging.png" alt="M√©trique sur le temps de d√©ploiement"></p><p>Il y a aussi d&#x27;autres m√©triques qui existent, concernant le code. Par exemple, vous pouvez voir le nombre de commits, ainsi que les diff√©rents contributeurs dans le menu Repository, sous-menu Contributors.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586230184054_commiters.png" alt="M√©triques sur les contributeurs"></p><p>Il est aussi int√©ressant de voir le nombre de commits par jours, pour √©valuer le temps de travail de chaque d√©veloppeur. Cette m√©trique est disponible dans le m√™me menu, sous-menu Charts.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="mettez-en-place-des-notifications-slack">Mettez en place des notifications Slack<a aria-hidden="true" class="hash-link" href="#mettez-en-place-des-notifications-slack" title="Direct link to heading">‚Äã</a></h3><p>La derni√®re √©tape est l&#x27;√©tape de <strong>feedback rapide</strong>. Cette √©tape est celle qui va nous permettre de faire le lien entre la <strong>production</strong> (ops), et les <strong>d√©veloppeurs</strong> (dev). C&#x27;est une √©tape qui donne de la visibilit√© aux d√©veloppeurs sur des probl√®mes qu&#x27;il peut y avoir en production. <strong>Plus rapide est la d√©tection des probl√®mes, plus rapide est leur correction</strong>. </p><p>Cette √©tape est le lien final qui permet d&#x27;avoir notre am√©lioration continue durant tout le cycle de vie de l&#x27;application. GitLab permet l&#x27;int√©gration avec beaucoup d&#x27;applications tierces. L&#x27;int√©gration la plus simple est l&#x27;int√©gration email. Afin d&#x27;int√©grer GitLab avec l&#x27;email, allez dans le menu Settings, sous-menu Integrations. Dans ce menu, choisissez &quot;Email on push&quot;. Sur le prochain √©cran, cochez la case Active, renseignez votre mail et cliquez sur &quot;Test settings and save changes&quot;.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586230769625_integration-mail.png" alt="Activez les notifications"></p><p>Vous allez maintenant √™tre alert√© des diff√©rents commits qu&#x27;il pourrait y avoir sur le contr√¥le de code source. Mais l&#x27;int√©gration n&#x27;est que partielle avec l&#x27;email. Le mieux est d&#x27;int√©grer un outil comme Slack qui prendra toutes les notifications de GitLab, et les affichera dans un channel d√©di√© √† votre application. Pour int√©grer Slack, il suffit d&#x27;aller dans le menu Integrations, et de choisir Slack Notifications.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586231586449_integration-slack.png" alt="Activez les notifications Slack"></p><p>De cette page, vous allez √™tre invit√© √† cr√©er un webhook Slack afin de l&#x27;int√©grer dans votre repository GitLab.</p><p>Choisissez un channel d√©di√© √† votre application afin de recevoir tous les messages associ√©s. Attention, les messages sont nombreux. Je vous conseille de ne pas l&#x27;ajouter dans le channel G√©n√©ral.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586232034197_slack-integration.png" alt="Configurez le channel Slack o√π recevoir les notifications"></p><p>Une fois le webhook cr√©√©, copiez l&#x27;URL d√©livr√©e par Slack afin de la coller dans GitLab.</p><p>Lorsque l&#x27;int√©gration avec Slack est finie, vous recevrez tous les messages des √©v√©nements GitLab dans le channel associ√©.</p><p><img src="https://user.oc-static.com/upload/2019/05/23/15586232703011_slack.png" alt="Slack avec vos notifications de GitLab"></p><blockquote><p>Nous avons donc rempli les deux derni√®res √©tapes de la livraison continue : </p><ol><li>‚úÖLa codification de l&#x27;infrastructure avec l&#x27;<strong>Infrastructure-as-Code</strong>.</li><li>‚úÖLe <strong>d√©ploiement</strong> de votre application.</li><li>‚úÖLe <strong>test</strong> de votre application en environnement de test.</li><li>‚úÖLa <strong>supervision</strong> de l&#x27;application.</li><li>‚úÖLa mise en place de <strong>notifications</strong> d&#x27;alerte.</li></ol></blockquote><hr><h2 class="anchor anchorWithStickyNavbar_31ik" id="annexes">Annexes<a aria-hidden="true" class="hash-link" href="#annexes" title="Direct link to heading">‚Äã</a></h2><ul><li><a href="https://openclassrooms.com/fr/courses/2035736-mettez-en-place-lintegration-et-la-livraison-continues-avec-la-demarche-devops" target="_blank" rel="noopener noreferrer">Mettez en place l&#x27;int√©gration et la livraison continues avec la d√©marche DevOps - OpenClassroom</a> ;</li><li><a href="https://www.linkedin.com/learning/paths/devenir-expert-experte-en-devops?u=56745737" target="_blank" rel="noopener noreferrer">Devenir expert / experte en DevOps - LinkedIn Learning </a> ;</li><li><a href="https://www.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment" target="_blank" rel="noopener noreferrer">Continuous integration vs. continuous delivery vs. continuous deployment - Atlasian</a></li><li><a href="https://www.youtube.com/watch?v=Xrgk023l4lI" target="_blank" rel="noopener noreferrer">DevOps In 5 Minutes | What Is DevOps? - Simplilearn (Youtube)</a></li></ul><hr><p><em>R√©alis√© en Markdown avec <a href="https://dillinger.io/" target="_blank" rel="noopener noreferrer">Dillinger</a> - Par <a href="https://www.nicolas-barbarisi.com" target="_blank" rel="noopener noreferrer">Nicolas Barbarisi</a></em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/Gestion du SI\Management d&#x27;√©quipe\L&#x27;int√©gration et la livraison continues avec la d√©marche DevOps.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/lintegration-et-la-livraison-continues-avec-la-demarche-devops"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->L&#x27;int√©gration et la livraison continues avec la d√©marche DevOp</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Sp√©cialit√© D√©veloppement/manage-docs-versions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Manage Docs Versions<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quest-ce-que-lint√©gration-continue-" class="table-of-contents__link toc-highlight">Qu&#39;est-ce que l&#39;int√©gration continue ?</a><ul><li><a href="#√©tape-1--planifiez-votre-d√©veloppement" class="table-of-contents__link toc-highlight">√âtape 1 : Planifiez votre d√©veloppement</a></li><li><a href="#√©tape-2--compilez-et-int√©grez-votre-code" class="table-of-contents__link toc-highlight">√âtape 2 : Compilez et int√©grez votre code</a></li><li><a href="#√©tape-3--testez-votre-code" class="table-of-contents__link toc-highlight">√âtape 3 : Testez votre code</a></li><li><a href="#√©tape-4--mesurez-la-qualit√©-de-votre-code" class="table-of-contents__link toc-highlight">√âtape 4 : Mesurez la qualit√© de votre code</a></li><li><a href="#√©tape-5--g√©rez-les-livrables-de-votre-application" class="table-of-contents__link toc-highlight">√âtape 5 : G√©rez les livrables de votre application</a></li><li><a href="#utilisez-gitlab-pour-mettre-en-place-un-pipeline-cicd" class="table-of-contents__link toc-highlight">Utilisez GitLab pour mettre en place un pipeline CI/CD</a></li></ul></li><li><a href="#planifiez-votre-d√©veloppement" class="table-of-contents__link toc-highlight">Planifiez votre d√©veloppement</a><ul><li><a href="#cr√©ez-votre-projet-gitlab" class="table-of-contents__link toc-highlight">Cr√©ez votre projet GitLab</a></li><li><a href="#cr√©ez-votre-premi√®re-epic" class="table-of-contents__link toc-highlight">Cr√©ez votre premi√®re epic</a></li><li><a href="#cr√©ez-votre-premi√®re-user-story" class="table-of-contents__link toc-highlight">Cr√©ez votre premi√®re user story</a></li><li><a href="#organisez-votre-backlog" class="table-of-contents__link toc-highlight">Organisez votre backlog</a></li></ul></li><li><a href="#int√©grez-votre-code-en-continu" class="table-of-contents__link toc-highlight">Int√©grez votre code en continu</a><ul><li><a href="#clonez-le-projet-sur-votre-poste" class="table-of-contents__link toc-highlight">Clonez le projet sur votre poste</a></li><li><a href="#activez-lint√©gration-continue-sur-votre-projet-avec-gitlab" class="table-of-contents__link toc-highlight">Activez l&#39;int√©gration continue sur votre projet avec GitLab</a></li><li><a href="#lancez-votre-pipeline-cicd" class="table-of-contents__link toc-highlight">Lancez votre pipeline CI/CD</a></li><li><a href="#et-si-lapplication-contient-un-bug-" class="table-of-contents__link toc-highlight">Et si l&#39;application contient un bug ?</a></li></ul></li><li><a href="#garantissez-la-qualit√©-de-votre-code" class="table-of-contents__link toc-highlight">Garantissez la qualit√© de votre code</a><ul><li><a href="#mesurez-la-qualit√©-de-votre-code" class="table-of-contents__link toc-highlight">Mesurez la qualit√© de votre code</a></li><li><a href="#packagez-votre-application-pour-la-d√©ployer" class="table-of-contents__link toc-highlight">Packagez votre application pour la d√©ployer</a></li><li><a href="#les-autres-outils-de-lint√©gration-continue" class="table-of-contents__link toc-highlight">Les autres outils de l&#39;int√©gration continue</a></li></ul></li><li><a href="#exercice--mettez-en-place-le-pipeline-ci-de-votre-application-avec-gitlab" class="table-of-contents__link toc-highlight">Exercice ! Mettez en place le pipeline CI de votre application avec GitLab</a><ul><li><a href="#description" class="table-of-contents__link toc-highlight">Description</a></li><li><a href="#question" class="table-of-contents__link toc-highlight">Question</a></li><li><a href="#r√©ponse" class="table-of-contents__link toc-highlight">R√©ponse</a></li></ul></li><li><a href="#quest-ce-que-la-livraison-continue-" class="table-of-contents__link toc-highlight">Qu&#39;est-ce que la livraison continue ?</a><ul><li><a href="#√©tape-1--codifiez-votre-infrastructure-avec-linfrastructure-as-code" class="table-of-contents__link toc-highlight">√âtape 1 : Codifiez votre infrastructure avec l&#39;Infrastructure-as-Code</a></li><li><a href="#√©tape-2--d√©ployez-votre-application" class="table-of-contents__link toc-highlight">√âtape 2 : D√©ployez votre application</a></li><li><a href="#√©tape-3--testez-votre-application" class="table-of-contents__link toc-highlight">√âtape 3 : Testez votre application</a></li><li><a href="#√©tape-4--supervisez-le-comportement-de-votre-application" class="table-of-contents__link toc-highlight">√âtape 4 : Supervisez le comportement de votre application</a></li><li><a href="#√©tape-5--mettez-en-place-des-notifications-dalertes" class="table-of-contents__link toc-highlight">√âtape 5 : Mettez en place des notifications d&#39;alertes</a></li></ul></li><li><a href="#codifiez-votre-infrastructure" class="table-of-contents__link toc-highlight">Codifiez votre infrastructure</a><ul><li><a href="#construisez-les-images-de-votre-application-avec-docker" class="table-of-contents__link toc-highlight">Construisez les images de votre application avec Docker</a></li><li><a href="#d√©ployez-votre-application-avec-docker-compose" class="table-of-contents__link toc-highlight">D√©ployez votre application avec Docker Compose</a></li></ul></li><li><a href="#d√©ployez-et-testez-votre-code-sur-diff√©rents-environnements" class="table-of-contents__link toc-highlight">D√©ployez et testez votre code sur diff√©rents environnements</a><ul><li><a href="#pr√©parez-votre-environnement-de-travail" class="table-of-contents__link toc-highlight">Pr√©parez votre environnement de travail</a></li></ul></li><li><a href="#monitorez-votre-application" class="table-of-contents__link toc-highlight">Monitorez votre application</a><ul><li><a href="#supervisez-votre-application-avec-prometheus" class="table-of-contents__link toc-highlight">Supervisez votre application avec Prometheus</a></li><li><a href="#mettez-en-place-des-notifications-slack" class="table-of-contents__link toc-highlight">Mettez en place des notifications Slack</a></li></ul></li><li><a href="#annexes" class="table-of-contents__link toc-highlight">Annexes</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.601d82d0.js"></script>
<script src="/assets/js/main.c29397b4.js"></script>
</body>
</html>